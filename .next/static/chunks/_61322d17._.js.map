{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/lib/api.js"],"sourcesContent":["// lib/api.js\r\n\r\n// ==============================\r\n// Config\r\n// ==============================\r\nconst BASE = (process.env.NEXT_PUBLIC_API_BASE_URL || \"http://localhost:4000\").trim();\r\n\r\n// ==============================\r\n// Internal state (registered by AuthProvider)\r\n// ==============================\r\nlet _getAccessToken = null;\r\nlet _onUnauthorized = null;\r\n// ใช้กัน “stampede” ตอน refresh token ให้ run ครั้งเดียวแล้ว await ร่วมกัน\r\nlet _refreshPromise = null;\r\n\r\n// ==============================\r\n// Small utilities\r\n// ==============================\r\nfunction isAbsoluteUrl(u) {\r\n  return /^https?:\\/\\//i.test(String(u || \"\"));\r\n}\r\n\r\nfunction trimTrailingSlash(s) {\r\n  return String(s || \"\").replace(/\\/+$/g, \"\");\r\n}\r\nfunction trimLeadingSlash(s) {\r\n  return String(s || \"\").replace(/^\\/+/g, \"\");\r\n}\r\n\r\n/**\r\n * รวม BASE + path ให้เป็น URL สำหรับ “แสดงผล” (เช่น src/href) ไม่ยิง request เอง\r\n * - รองรับทั้ง path (`/api/...` หรือ `api/...`) และ absolute URL (ข้าม BASE)\r\n * - ปรับ slash อัตโนมัติ ไม่ให้ซ้ำกัน\r\n */\r\nexport function apiURL(pathOrUrl = \"\") {\r\n  const u = String(pathOrUrl || \"\");\r\n  if (!u) return trimTrailingSlash(BASE); // กรณีอยากได้ BASE เปล่า ๆ\r\n  if (isAbsoluteUrl(u)) return u;\r\n\r\n  const base = trimTrailingSlash(BASE);\r\n  const path = \"/\" + trimLeadingSlash(u); // บังคับให้ขึ้นต้นด้วย /\r\n  return base + path;\r\n}\r\n\r\n/** แปลง response -> data (auto json/text) */\r\nexport async function parseResponse(res) {\r\n  const ct = res.headers.get(\"content-type\") || \"\";\r\n  const data = ct.includes(\"application/json\") ? await res.json() : await res.text();\r\n  return data;\r\n}\r\n\r\n/** ตรวจว่าเป็น URL refresh token (กันวนลูป onUnauthorized) */\r\nfunction isAuthRefreshUrl(url) {\r\n  try {\r\n    const u = new URL(url, BASE);\r\n    // ตรงกับ backend path: /api/auth/refresh\r\n    return /\\/api\\/auth\\/refresh($|\\?)/i.test(u.pathname);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ==============================\r\n// Public API\r\n// ==============================\r\n\r\n/**\r\n * ให้ AuthProvider เรียกตอนบูตแอป เพื่อบอกว่าจะเอา accessToken จากไหน\r\n * และถ้าเจอ 401 ให้ทำอะไร (เช่น เรียก refresh)\r\n */\r\nexport function configureApiAuth({ getAccessToken, onUnauthorized } = {}) {\r\n  _getAccessToken = typeof getAccessToken === \"function\" ? getAccessToken : null;\r\n  _onUnauthorized = typeof onUnauthorized === \"function\" ? onUnauthorized : null;\r\n}\r\n\r\n/**\r\n * Wrapper ของ fetch สำหรับคุยกับ backend\r\n * ข้อดี:\r\n *  - รับทั้ง absolute URL และ path (แนะนำ path `/api/...`)\r\n *  - เติม BASE ให้อัตโนมัติเมื่อเป็น path\r\n *  - แนบ Authorization Bearer ให้อัตโนมัติ (ถ้ามี configureApiAuth)\r\n *  - จัดการ 401 -> เรียก onUnauthorized() (เช่น refresh) + retry ให้อัตโนมัติ 1 ครั้ง\r\n *  - ส่ง cookie เสมอ (credentials: \"include\")\r\n *  - ถ้า body เป็น object (ไม่ใช่ FormData) จะใส่ content-type: application/json และ stringify ให้\r\n *\r\n * @param {string} pathOrUrl - \"/api/...\" หรือ absolute URL\r\n * @param {RequestInit & { body?: any }} init\r\n * @param {{ getAccessToken?: ()=>string, onUnauthorized?: ()=>Promise<boolean>, retryOnce?: boolean }} opts\r\n */\r\nexport async function apiFetch(pathOrUrl, init = {}, opts = {}) {\r\n  // 1) สร้าง URL\r\n  const url = isAbsoluteUrl(pathOrUrl) ? String(pathOrUrl) : apiURL(pathOrUrl);\r\n\r\n  // 2) เตรียม header + body\r\n  const isForm = typeof FormData !== \"undefined\" && init?.body instanceof FormData;\r\n  const headers = new Headers(init?.headers || {});\r\n  if (!isForm && init?.body && typeof init.body === \"object\" && !headers.has(\"content-type\")) {\r\n    headers.set(\"content-type\", \"application/json\");\r\n  }\r\n\r\n  // 3) เลือก token getter / unauthorized handler (สามารถ override รายคำขอได้)\r\n  const getAccessToken =\r\n    typeof opts.getAccessToken === \"function\" ? opts.getAccessToken : _getAccessToken;\r\n  const onUnauthorized =\r\n    typeof opts.onUnauthorized === \"function\" ? opts.onUnauthorized : _onUnauthorized;\r\n\r\n  // 4) แนบ Bearer ถ้ามี\r\n  if (typeof getAccessToken === \"function\") {\r\n    const token = getAccessToken();\r\n    if (token && !headers.has(\"authorization\")) {\r\n      headers.set(\"authorization\", `Bearer ${token}`);\r\n    }\r\n  }\r\n\r\n  const requestInit = {\r\n    method: init?.method || \"GET\",\r\n    credentials: \"include\",\r\n    cache: \"no-store\",\r\n    ...init,\r\n    headers,\r\n    body: isForm\r\n      ? init.body\r\n      : init?.body && typeof init.body === \"object\"\r\n      ? JSON.stringify(init.body)\r\n      : init?.body,\r\n  };\r\n\r\n  // 5) ยิงครั้งที่ 1\r\n  const allowRefresh = !isAuthRefreshUrl(url);\r\n  const retryOnce = opts.retryOnce !== false; // default = true\r\n  let res = await fetch(url, requestInit);\r\n\r\n  // 6) ถ้า 401 และอนุญาต refresh -> เรียก onUnauthorized() แบบรวมศูนย์\r\n  if (res.status === 401 && allowRefresh && typeof onUnauthorized === \"function\") {\r\n    if (!_refreshPromise) {\r\n      _refreshPromise = (async () => {\r\n        try {\r\n          const ok = await onUnauthorized();\r\n          return !!ok;\r\n        } finally {\r\n          // ปล่อยให้คำขออื่น ๆ ได้ await ก่อน แล้วค่อยล้างตัวแปร\r\n          setTimeout(() => {\r\n            _refreshPromise = null;\r\n          }, 0);\r\n        }\r\n      })();\r\n    }\r\n\r\n    const ok = await _refreshPromise;\r\n\r\n    // 7) ถ้า refresh สำเร็จ และอนุญาต retry\r\n    if (ok && retryOnce) {\r\n      // แนบ token ล่าสุดก่อนยิงซ้ำ\r\n      if (typeof getAccessToken === \"function\") {\r\n        const t2 = getAccessToken();\r\n        if (t2) requestInit.headers.set(\"authorization\", `Bearer ${t2}`);\r\n      }\r\n      res = await fetch(url, requestInit);\r\n    }\r\n  }\r\n\r\n  // 8) parse + throw ถ้าไม่ ok\r\n  const data = await parseResponse(res);\r\n  if (!res.ok) {\r\n    const msg =\r\n      (data && (data.error || data.message)) || (typeof data === \"string\" ? data : \"Request failed\");\r\n    const err = new Error(msg);\r\n    err.status = res.status;\r\n    err.data = data;\r\n    throw err;\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// ==============================\r\n// (Optional) Named export utilities\r\n// ==============================\r\nexport { isAbsoluteUrl };\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/access/rules.js"],"sourcesContent":["// access/rules.js\r\n\r\n// ---------- ระดับตำแหน่ง ----------\r\nexport const LEVEL_RANK = {\r\n  STAF: 1,\r\n  SVR: 2,\r\n  ASST: 3,\r\n  MANAGER: 4,\r\n  MD: 5,\r\n};\r\n\r\n// ---------- helpers ----------\r\nexport function isAdmin(user) {\r\n  return (user?.role?.name || \"\").toLowerCase() === \"admin\";\r\n}\r\n\r\nexport function userDeptCodes(user) {\r\n  // return set ของ code แผนกทั้งหมด เช่น { \"HR\", \"IT\", \"MK\" }\r\n  return new Set(\r\n    (user?.departments || []).map((d) => String(d.code).toUpperCase())\r\n  );\r\n}\r\n\r\nexport function userRank(user) {\r\n  const lvl = user?.primary?.level || user?.positionLevel;\r\n  return LEVEL_RANK[String(lvl).toUpperCase()] || 0;\r\n}\r\n\r\nexport function ieq(a, b) {\r\n  return String(a || \"\").toLowerCase() === String(b || \"\").toLowerCase();\r\n}\r\n\r\n// ---------- กฎการเข้าถึง ----------\r\n/**\r\n * rule.require:\r\n *  - roleAny: [\"admin\"]\r\n *  - deptAny: [\"HR\"]\r\n *  - minRank: \"MANAGER\"\r\n */\r\nconst RULES = [\r\n  // 👑 Admin zone\r\n  { pattern: /^\\/admin/, require: { roleAny: [\"admin\"] } },\r\n\r\n  // HR module (summary, reports, evals)\r\n  { pattern: /^\\/hr/, require: { deptAny: [\"HR\"] } },\r\n\r\n  // QMS module\r\n  { pattern: /^\\/qms/, require: { deptAny: [\"QMS\"] } },\r\n\r\n  // IT module\r\n  { pattern: /^\\/it/, require: { deptAny: [\"IT\"] } },\r\n\r\n  // Approvals (ต้องเป็น Manager ขึ้นไป)\r\n  { pattern: /^\\/approvals/, require: { minRank: \"MANAGER\" } },\r\n\r\n  // My profile → ใครก็เข้าได้ (แค่ต้อง login)\r\n  { pattern: /^\\/me/, require: {} },\r\n\r\n  // Dashboard หลังบ้าน (ทุกคนที่ login ได้)\r\n  { pattern: /^\\/dashboard/, require: {} },\r\n];\r\n\r\n// ---------- API ----------\r\nexport function findRule(path) {\r\n  return RULES.find((r) => r.pattern.test(path));\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;AAElB,qCAAqC;;;;;;;;;;;;;;;AAC9B,MAAM,aAAa;IACxB,MAAM;IACN,KAAK;IACL,MAAM;IACN,SAAS;IACT,IAAI;AACN;AAGO,SAAS,QAAQ,IAAI;QAClB;IAAR,OAAO,CAAC,CAAA,iBAAA,4BAAA,aAAA,KAAM,IAAI,cAAV,iCAAA,WAAY,IAAI,KAAI,EAAE,EAAE,WAAW,OAAO;AACpD;AAEO,SAAS,cAAc,IAAI;IAChC,4DAA4D;IAC5D,OAAO,IAAI,IACT,CAAC,CAAA,iBAAA,2BAAA,KAAM,WAAW,KAAI,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,OAAO,EAAE,IAAI,EAAE,WAAW;AAEnE;AAEO,SAAS,SAAS,IAAI;QACf;IAAZ,MAAM,MAAM,CAAA,iBAAA,4BAAA,gBAAA,KAAM,OAAO,cAAb,oCAAA,cAAe,KAAK,MAAI,iBAAA,2BAAA,KAAM,aAAa;IACvD,OAAO,UAAU,CAAC,OAAO,KAAK,WAAW,GAAG,IAAI;AAClD;AAEO,SAAS,IAAI,CAAC,EAAE,CAAC;IACtB,OAAO,OAAO,KAAK,IAAI,WAAW,OAAO,OAAO,KAAK,IAAI,WAAW;AACtE;AAEA,qCAAqC;AACrC;;;;;CAKC,GACD,MAAM,QAAQ;IACZ,gBAAgB;IAChB;QAAE,SAAS;QAAY,SAAS;YAAE,SAAS;gBAAC;aAAQ;QAAC;IAAE;IAEvD,sCAAsC;IACtC;QAAE,SAAS;QAAS,SAAS;YAAE,SAAS;gBAAC;aAAK;QAAC;IAAE;IAEjD,aAAa;IACb;QAAE,SAAS;QAAU,SAAS;YAAE,SAAS;gBAAC;aAAM;QAAC;IAAE;IAEnD,YAAY;IACZ;QAAE,SAAS;QAAS,SAAS;YAAE,SAAS;gBAAC;aAAK;QAAC;IAAE;IAEjD,sCAAsC;IACtC;QAAE,SAAS;QAAgB,SAAS;YAAE,SAAS;QAAU;IAAE;IAE3D,4CAA4C;IAC5C;QAAE,SAAS;QAAS,SAAS,CAAC;IAAE;IAEhC,0CAA0C;IAC1C;QAAE,SAAS;QAAgB,SAAS,CAAC;IAAE;CACxC;AAGM,SAAS,SAAS,IAAI;IAC3B,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,IAAI,CAAC;AAC1C","debugId":null}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/local-auth.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { apiFetch, configureApiAuth } from \"@/lib/api\";\r\nimport { findRule, isAdmin, userDeptCodes, userRank, LEVEL_RANK } from \"@/access/rules\";\r\n\r\nconst AuthCtx = createContext(null);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [isReady, setReady] = useState(false);\r\n  const accessTokenRef = useRef(null);\r\n\r\n  const refresh = useCallback(async () => {\r\n    try {\r\n      const data = await apiFetch(\"/api/auth/refresh\", { method: \"POST\" });\r\n      accessTokenRef.current = data?.accessToken || null;\r\n      setUser(data?.user || null);\r\n      return true;\r\n    } catch {\r\n      accessTokenRef.current = null;\r\n      setUser(null);\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  const fetchMe = useCallback(async () => {\r\n    try {\r\n      const data = await apiFetch(\"/api/auth/me\");\r\n      setUser(data?.user || null);\r\n      return !!data?.user;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  // 👉 ลงทะเบียน token getter + handler ให้ apiFetch ใช้ทั่วแอป\r\n  useEffect(() => {\r\n    configureApiAuth({\r\n      getAccessToken: () => accessTokenRef.current,\r\n      onUnauthorized: refresh,\r\n    });\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const ok = await fetchMe();\r\n      if (!ok) await refresh();\r\n      setReady(true);\r\n    })();\r\n  }, [fetchMe, refresh]);\r\n\r\n  const signIn = useCallback(\r\n    async (email, password) => {\r\n      await apiFetch(\"/api/auth/login\", {\r\n        method: \"POST\",\r\n        body: { email, password },\r\n      });\r\n      await fetchMe();\r\n      return true;\r\n    },\r\n    [fetchMe]\r\n  );\r\n\r\n  const signOut = useCallback(async () => {\r\n    try {\r\n      await apiFetch(\"/api/auth/logout\", { method: \"POST\" });\r\n    } catch {}\r\n    accessTokenRef.current = null;\r\n    setUser(null);\r\n    return true;\r\n  }, []);\r\n\r\n  // (ยังคง authedFetch ไว้สำหรับบางเคสที่อยาก override เป็นรายคำขอ)\r\n  async function authedFetch(pathOrUrl, init = {}) {\r\n    const isAbs = /^https?:\\/\\//i.test(pathOrUrl);\r\n    return apiFetch(pathOrUrl, init, { absoluteUrl: isAbs });\r\n  }\r\n\r\n  function canVisit(path) {\r\n    return canVisitPure(path, user);\r\n  }\r\n\r\n  const value = {\r\n    isReady,\r\n    isAuthenticated: !!user,\r\n    user,\r\n    setUser,\r\n    accessToken: accessTokenRef.current,\r\n    signIn,\r\n    signOut,\r\n    refresh,\r\n    authedFetch,\r\n    canVisit,\r\n  };\r\n\r\n  return <AuthCtx.Provider value={value}>{children}</AuthCtx.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n  const ctx = useContext(AuthCtx);\r\n  if (!ctx) throw new Error(\"useAuth must be used within <AuthProvider/>\");\r\n  return ctx;\r\n}\r\n\r\n// ---- Guards (คงเดิม) ----\r\nexport function hasRolePure(user, roleNameMaybe) {\r\n  const role = (user?.role?.name || user?.roleName || \"\").toLowerCase();\r\n  const targets = Array.isArray(roleNameMaybe)\r\n    ? roleNameMaybe\r\n    : [roleNameMaybe].filter(Boolean);\r\n  return targets.map((t) => String(t).toLowerCase()).includes(role);\r\n}\r\nexport function useHasRole(roleNameMaybe) {\r\n  const { user } = useAuth();\r\n  return hasRolePure(user, roleNameMaybe);\r\n}\r\nexport function hasRole(userOrRoleName, roleNameMaybe) {\r\n  if (typeof userOrRoleName === \"string\") return useHasRole(userOrRoleName);\r\n  return hasRolePure(userOrRoleName, roleNameMaybe);\r\n}\r\nexport function canVisitPure(path, user) {\r\n  if (!user) return false;\r\n  if (isAdmin(user)) return true;\r\n  const rule = findRule(path);\r\n  if (!rule) return true;\r\n  const { require = {} } = rule;\r\n  const codes = userDeptCodes(user);\r\n  const rank = userRank(user);\r\n  if (require.deptAny?.length) {\r\n    const ok = require.deptAny.some((c) => codes.has(String(c).toUpperCase()));\r\n    if (!ok) return false;\r\n  }\r\n  if (require.deptAll?.length) {\r\n    const ok = require.deptAll.every((c) => codes.has(String(c).toUpperCase()));\r\n    if (!ok) return false;\r\n  }\r\n  if (require.minRank) {\r\n    const need = LEVEL_RANK[String(require.minRank).toUpperCase()] || 0;\r\n    if (rank < need) return false;\r\n  }\r\n  return true;\r\n}\r\nexport function useCanVisit(path) {\r\n  const { user } = useAuth();\r\n  return canVisitPure(path, user);\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 481, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/providers.js"],"sourcesContent":["'use client';\r\n\r\nimport { ThemeProvider } from 'next-themes';\r\nimport { AuthProvider } from '@/components/local-auth';\r\n\r\nexport default function Providers({ children }) {\r\n  return (\r\n    <AuthProvider>\r\n      <ThemeProvider\r\n        attribute=\"class\"\r\n        defaultTheme=\"light\"\r\n        enableSystem={false}\r\n        storageKey=\"theme\"\r\n        disableTransitionOnChange\r\n      >\r\n        {children}\r\n      </ThemeProvider>\r\n    </AuthProvider>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,UAAU,KAAY;QAAZ,EAAE,QAAQ,EAAE,GAAZ;IAChC,qBACE,6LAAC,+IAAY;kBACX,cAAA,6LAAC,oKAAa;YACZ,WAAU;YACV,cAAa;YACb,cAAc;YACd,YAAW;YACX,yBAAyB;sBAExB;;;;;;;;;;;AAIT;KAdwB","debugId":null}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/lib/utils.js"],"sourcesContent":["import { clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\"\r\n\r\nexport function cn(...inputs) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS;IAAG,IAAA,IAAA,OAAA,UAAA,QAAA,AAAG,SAAH,UAAA,OAAA,OAAA,GAAA,OAAA,MAAA;QAAG,OAAH,QAAA,SAAA,CAAA,KAAS;;IAC1B,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB","debugId":null}},
    {"offset": {"line": 544, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/ui/button.jsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\r\n        outline:\r\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80\",\r\n        ghost:\r\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\r\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\r\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\r\n        icon: \"size-9\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nfunction Button({\r\n  className,\r\n  variant,\r\n  size,\r\n  asChild = false,\r\n  ...props\r\n}) {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      data-slot=\"button\"\r\n      className={cn(buttonVariants({ variant, size, className }))}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Button, buttonVariants }"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,IAAA,0KAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,KAMf;QANe,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OACJ,GANe;IAOd,MAAM,OAAO,UAAU,2KAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAhBS","debugId":null}},
    {"offset": {"line": 610, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/ui/ThemeToggle.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useTheme } from \"next-themes\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { Sun, Moon } from \"lucide-react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\n\r\nexport default function ThemeToggle() {\r\n  const { theme, setTheme } = useTheme();\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => setMounted(true), []);\r\n  if (!mounted) return null;\r\n\r\n  const isDark = theme === \"dark\";\r\n\r\n  return (\r\n    <button\r\n      onClick={() => setTheme(isDark ? \"light\" : \"dark\")}\r\n      className=\"\r\n        flex items-center justify-start md:justify-center gap-2 rounded-md \r\n        p-2 md:px-3 md:py-2\r\n        bg-white/20 text-black dark:bg-white/10 dark:text-white\r\n        hover:bg-white/30 dark:hover:bg-white/20\r\n        transition\r\n        w-full md:w-auto\r\n      \"\r\n      aria-label=\"Toggle Dark Mode\"\r\n    >\r\n      <AnimatePresence mode=\"wait\" initial={false}>\r\n        {isDark ? (\r\n          <motion.span\r\n            key=\"sun\"\r\n            initial={{ rotate: -90, opacity: 0 }}\r\n            animate={{ rotate: 0, opacity: 1 }}\r\n            exit={{ rotate: 90, opacity: 0 }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            <Sun className=\"h-5 w-5 text-yellow-400 transition-transform md:hover:scale-110\" />\r\n          </motion.span>\r\n        ) : (\r\n          <motion.span\r\n            key=\"moon\"\r\n            initial={{ rotate: 90, opacity: 0 }}\r\n            animate={{ rotate: 0, opacity: 1 }}\r\n            exit={{ rotate: -90, opacity: 0 }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            <Moon className=\"h-5 w-5 text-indigo-500 transition-transform md:hover:scale-110\" />\r\n          </motion.span>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <span className=\"block text-sm font-medium md:hidden\">\r\n        {isDark ? \"Light Mode\" : \"Dark Mode\"}\r\n      </span>\r\n    </button>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AAAA;;;AALA;;;;;AAOe,SAAS;;IACtB,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,+JAAQ;IACpC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;iCAAC,IAAM,WAAW;gCAAO,EAAE;IACpC,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,SAAS,UAAU;IAEzB,qBACE,6LAAC;QACC,SAAS,IAAM,SAAS,SAAS,UAAU;QAC3C,WAAU;QAQV,cAAW;;0BAEX,6LAAC,+MAAe;gBAAC,MAAK;gBAAO,SAAS;0BACnC,uBACC,6LAAC,uMAAM,CAAC,IAAI;oBAEV,SAAS;wBAAE,QAAQ,CAAC;wBAAI,SAAS;oBAAE;oBACnC,SAAS;wBAAE,QAAQ;wBAAG,SAAS;oBAAE;oBACjC,MAAM;wBAAE,QAAQ;wBAAI,SAAS;oBAAE;oBAC/B,YAAY;wBAAE,UAAU;oBAAI;8BAE5B,cAAA,6LAAC,0MAAG;wBAAC,WAAU;;;;;;mBANX;;;;yCASN,6LAAC,uMAAM,CAAC,IAAI;oBAEV,SAAS;wBAAE,QAAQ;wBAAI,SAAS;oBAAE;oBAClC,SAAS;wBAAE,QAAQ;wBAAG,SAAS;oBAAE;oBACjC,MAAM;wBAAE,QAAQ,CAAC;wBAAI,SAAS;oBAAE;oBAChC,YAAY;wBAAE,UAAU;oBAAI;8BAE5B,cAAA,6LAAC,6MAAI;wBAAC,WAAU;;;;;;mBANZ;;;;;;;;;;0BAWV,6LAAC;gBAAK,WAAU;0BACb,SAAS,eAAe;;;;;;;;;;;;AAIjC;GAnDwB;;QACM,+JAAQ;;;KADd","debugId":null}},
    {"offset": {"line": 735, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/ui/stateful-button.jsx"],"sourcesContent":["\"use client\";\r\nimport { forwardRef } from \"react\";\r\nimport { motion } from \"motion/react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst StatefulButton = forwardRef(function StatefulButton(\r\n  {\r\n    loading = false,\r\n    loadingText = \"Loading...\",\r\n    disabled,\r\n    className,\r\n    children,\r\n    ...rest // ← จะไม่มี loading ติดไปใน DOM แล้ว\r\n  },\r\n  ref\r\n) {\r\n  const isDisabled = disabled || loading;\r\n\r\n  return (\r\n    <motion.button\r\n      ref={ref}\r\n      type=\"button\"\r\n      {...rest}\r\n      disabled={isDisabled}\r\n      aria-busy={loading || undefined}\r\n      data-loading={loading ? \"\" : undefined}\r\n      className={cn(\r\n        \"inline-flex h-10 items-center justify-center rounded-md px-4 text-sm transition\",\r\n        isDisabled ? \"opacity-70\" : \"\",\r\n        className\r\n      )}\r\n      whileTap={!isDisabled ? { scale: 0.985 } : undefined}\r\n    >\r\n      {loading ? loadingText : children}\r\n    </motion.button>\r\n  );\r\n});\r\n\r\nexport default StatefulButton;\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAHA;;;;;AAKA,MAAM,+BAAiB,IAAA,2KAAU,OAAC,SAAS,eACzC,KAOC,EACD,GAAG;QARH,EACE,UAAU,KAAK,EACf,cAAc,YAAY,EAC1B,QAAQ,EACR,SAAS,EACT,QAAQ,EACR,GAAG,KAAK,qCAAqC;MAC9C,GAPD;IAUA,MAAM,aAAa,YAAY;IAE/B,qBACE,6LAAC,uMAAM,CAAC,MAAM;QACZ,KAAK;QACL,MAAK;QACJ,GAAG,IAAI;QACR,UAAU;QACV,aAAW,WAAW;QACtB,gBAAc,UAAU,KAAK;QAC7B,WAAW,IAAA,qHAAE,EACX,mFACA,aAAa,eAAe,IAC5B;QAEF,UAAU,CAAC,aAAa;YAAE,OAAO;QAAM,IAAI;kBAE1C,UAAU,cAAc;;;;;;AAG/B;;uCAEe","debugId":null}},
    {"offset": {"line": 782, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/layout/navbar/NavItem.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport { motion } from \"framer-motion\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport function DesktopNavItem({ item }) {\r\n  const pathname = usePathname();\r\n  const isActive = pathname === item.href;\r\n  const Icon = item.icon;\r\n\r\n  return (\r\n    <Link\r\n      href={item.href}\r\n      aria-current={isActive ? \"page\" : undefined}\r\n      className={cn(\r\n        \"relative flex items-center gap-1 transition group\",\r\n        isActive\r\n          ? \"text-black dark:text-white font-semibold\"\r\n          : \"text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white\"\r\n      )}\r\n    >\r\n      <motion.span whileHover={{ rotate: -5, scale: 1.1 }} transition={{ duration: 0.2 }}>\r\n        <Icon\r\n          className={cn(\r\n            \"w-4 h-4 transition\",\r\n            isActive\r\n              ? \"text-black dark:text-white\"\r\n              : \"text-gray-500 dark:text-gray-400 group-hover:text-black dark:group-hover:text-white\"\r\n          )}\r\n        />\r\n      </motion.span>\r\n      {item.label}\r\n      {isActive && (\r\n        <motion.span\r\n          layoutId=\"nav-underline\"\r\n          className=\"absolute -bottom-1 left-0 h-0.5 w-full bg-black dark:bg-white\"\r\n        />\r\n      )}\r\n    </Link>\r\n  );\r\n}\r\n\r\nexport function MobileNavItem({ item, onClick }) {\r\n  const pathname = usePathname();\r\n  const isActive = pathname === item.href;\r\n  const Icon = item.icon;\r\n\r\n  return (\r\n    <Link\r\n      href={item.href}\r\n      onClick={onClick}\r\n      aria-current={isActive ? \"page\" : undefined}\r\n      className={cn(\r\n        \"flex items-center gap-3 rounded-md px-3 py-2.5 transition\",\r\n        \"text-gray-700 dark:text-gray-300 hover:bg-black/5 dark:hover:bg-white/5\",\r\n        isActive &&\r\n          \"font-semibold text-black dark:text-white relative before:absolute before:left-0 before:top-1/2 before:-translate-y-1/2 before:h-2 before:w-2 before:rounded-full before:bg-black dark:before:bg-white before:-ml-2\"\r\n      )}\r\n    >\r\n      <Icon className={cn(\"h-5 w-5\", isActive ? \"text-black dark:text-white\" : \"text-gray-500 dark:text-gray-400\")} />\r\n      {item.label}\r\n    </Link>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAOO,SAAS,eAAe,KAAQ;QAAR,EAAE,IAAI,EAAE,GAAR;;IAC7B,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,WAAW,aAAa,KAAK,IAAI;IACvC,MAAM,OAAO,KAAK,IAAI;IAEtB,qBACE,6LAAC,0KAAI;QACH,MAAM,KAAK,IAAI;QACf,gBAAc,WAAW,SAAS;QAClC,WAAW,IAAA,qHAAE,EACX,qDACA,WACI,6CACA;;0BAGN,6LAAC,uMAAM,CAAC,IAAI;gBAAC,YAAY;oBAAE,QAAQ,CAAC;oBAAG,OAAO;gBAAI;gBAAG,YAAY;oBAAE,UAAU;gBAAI;0BAC/E,cAAA,6LAAC;oBACC,WAAW,IAAA,qHAAE,EACX,sBACA,WACI,+BACA;;;;;;;;;;;YAIT,KAAK,KAAK;YACV,0BACC,6LAAC,uMAAM,CAAC,IAAI;gBACV,UAAS;gBACT,WAAU;;;;;;;;;;;;AAKpB;GAnCgB;;QACG,oJAAW;;;KADd;AAqCT,SAAS,cAAc,KAAiB;QAAjB,EAAE,IAAI,EAAE,OAAO,EAAE,GAAjB;;IAC5B,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,WAAW,aAAa,KAAK,IAAI;IACvC,MAAM,OAAO,KAAK,IAAI;IAEtB,qBACE,6LAAC,0KAAI;QACH,MAAM,KAAK,IAAI;QACf,SAAS;QACT,gBAAc,WAAW,SAAS;QAClC,WAAW,IAAA,qHAAE,EACX,6DACA,2EACA,YACE;;0BAGJ,6LAAC;gBAAK,WAAW,IAAA,qHAAE,EAAC,WAAW,WAAW,+BAA+B;;;;;;YACxE,KAAK,KAAK;;;;;;;AAGjB;IArBgB;;QACG,oJAAW;;;MADd","debugId":null}},
    {"offset": {"line": 896, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/config/routes.js"],"sourcesContent":["import {\r\n  findRule,\r\n  isAdmin,\r\n  userDeptCodes,\r\n  userRank,\r\n  LEVEL_RANK,\r\n} from \"@/access/rules\";\r\n\r\nimport {\r\n  Home, Info, Wrench, Mail, MessageSquare, Shield,\r\n  Building2, Users, ClipboardList, BarChart3, Wallet\r\n} from \"lucide-react\";\r\n\r\n/** ลิงก์พื้นฐาน (ไม่อยู่ในหมวด) */\r\nexport const BASE_LINKS = [\r\n  { label: \"Home\", href: \"/\", icon: Home },\r\n  { label: \"About\", href: \"#about\", icon: Info },\r\n  { label: \"Services\", href: \"#services\", icon: Wrench },\r\n  { label: \"Contact\", href: \"/contact\", icon: Mail },\r\n];\r\n\r\n/** หมวดหมู่ทั้งหมด (เพิ่ม/ลบ/แก้ได้ที่นี่ที่เดียว) */\r\nexport const CATEGORY_REGISTRY = [\r\n  {\r\n    id: \"hr\",\r\n    label: \"HR\",\r\n    icon: MessageSquare,\r\n    basePath: \"/hr\",\r\n    links: [\r\n      { label: \"งานของฉัน\",        href: \"/evals\",                  icon: ClipboardList },\r\n      { label: \"Approvals\",         href: \"/approvals\",              icon: ClipboardList },\r\n      { label: \"กำหนดรอบประเมิน\",   href: \"/hr/cycles\",              icon: ClipboardList },\r\n      { label: \"ดูรายงานประเมิน\",   href: \"/hr/reports/evaluations\", icon: BarChart3 },\r\n      { label: \"LineOA\",            href: \"/hr/lineoa\",              icon: MessageSquare },\r\n    ],\r\n  },\r\n  {\r\n    id: \"admin\",\r\n    label: \"Admin\",\r\n    icon: Shield,\r\n    basePath: \"/admin\",\r\n    links: [\r\n      { label: \"Departments\",   href: \"/admin/departments\",   icon: Building2 },\r\n      { label: \"Roles\",         href: \"/admin/roles\",         icon: Shield },\r\n      { label: \"Users\",         href: \"/admin/users\",         icon: Users },\r\n      { label: \"Contacts\",      href: \"/admin/contacts\",      icon: Mail },\r\n      { label: \"Organizations\", href: \"/admin/organizations\", icon: ClipboardList },\r\n    ],\r\n  },\r\n\r\n  // ---- ตัวอย่างหมวดใหม่: Finance ----\r\n  {\r\n    id: \"finance\",\r\n    label: \"Finance\",\r\n    icon: Wallet,\r\n    basePath: \"/finance\",\r\n    links: [\r\n      { label: \"ภาพรวมงบประมาณ\", href: \"/finance/overview\" },\r\n      { label: \"คำขอเบิกจ่าย\",   href: \"/finance/requests\" },\r\n      { label: \"รายงานการเงิน\",  href: \"/finance/reports\" },\r\n    ],\r\n  },\r\n];\r\n\r\n/* ===== Helpers: สิทธิ์กลาง ===== */\r\nexport function canVisitPath(path, user) {\r\n  if (!user) return false;\r\n  if (isAdmin(user)) return true;\r\n\r\n  const rule = findRule(path);\r\n  if (!rule) return true;\r\n\r\n  const { require = {} } = rule;\r\n  const codes = userDeptCodes(user);\r\n  const rank  = userRank(user);\r\n\r\n  if (require.deptAny?.length && !require.deptAny.some(c => codes.has(String(c).toUpperCase()))) return false;\r\n  if (require.deptAll?.length && !require.deptAll.every(c => codes.has(String(c).toUpperCase()))) return false;\r\n  if (require.minRank) {\r\n    const need = LEVEL_RANK[String(require.minRank).toUpperCase()] || 0;\r\n    if (rank < need) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function visibleLinks(user, links) {\r\n  return (links || []).filter(it => canVisitPath(it.href, user));\r\n}\r\n\r\nexport function visibleCategories(user) {\r\n  return CATEGORY_REGISTRY\r\n    .filter(cat => canVisitPath(cat.basePath, user))\r\n    .map(cat => ({ ...cat, links: visibleLinks(user, cat.links) }))\r\n    .filter(cat => cat.links.length > 0);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAMO,MAAM,aAAa;IACxB;QAAE,OAAO;QAAQ,MAAM;QAAK,MAAM,8MAAI;IAAC;IACvC;QAAE,OAAO;QAAS,MAAM;QAAU,MAAM,6MAAI;IAAC;IAC7C;QAAE,OAAO;QAAY,MAAM;QAAa,MAAM,mNAAM;IAAC;IACrD;QAAE,OAAO;QAAW,MAAM;QAAY,MAAM,6MAAI;IAAC;CAClD;AAGM,MAAM,oBAAoB;IAC/B;QACE,IAAI;QACJ,OAAO;QACP,MAAM,4OAAa;QACnB,UAAU;QACV,OAAO;YACL;gBAAE,OAAO;gBAAoB,MAAM;gBAA2B,MAAM,4OAAa;YAAC;YAClF;gBAAE,OAAO;gBAAqB,MAAM;gBAA2B,MAAM,4OAAa;YAAC;YACnF;gBAAE,OAAO;gBAAqB,MAAM;gBAA2B,MAAM,4OAAa;YAAC;YACnF;gBAAE,OAAO;gBAAqB,MAAM;gBAA2B,MAAM,kOAAS;YAAC;YAC/E;gBAAE,OAAO;gBAAqB,MAAM;gBAA2B,MAAM,4OAAa;YAAC;SACpF;IACH;IACA;QACE,IAAI;QACJ,OAAO;QACP,MAAM,mNAAM;QACZ,UAAU;QACV,OAAO;YACL;gBAAE,OAAO;gBAAiB,MAAM;gBAAwB,MAAM,gOAAS;YAAC;YACxE;gBAAE,OAAO;gBAAiB,MAAM;gBAAwB,MAAM,mNAAM;YAAC;YACrE;gBAAE,OAAO;gBAAiB,MAAM;gBAAwB,MAAM,gNAAK;YAAC;YACpE;gBAAE,OAAO;gBAAiB,MAAM;gBAAwB,MAAM,6MAAI;YAAC;YACnE;gBAAE,OAAO;gBAAiB,MAAM;gBAAwB,MAAM,4OAAa;YAAC;SAC7E;IACH;IAEA,sCAAsC;IACtC;QACE,IAAI;QACJ,OAAO;QACP,MAAM,mNAAM;QACZ,UAAU;QACV,OAAO;YACL;gBAAE,OAAO;gBAAkB,MAAM;YAAoB;YACrD;gBAAE,OAAO;gBAAkB,MAAM;YAAoB;YACrD;gBAAE,OAAO;gBAAkB,MAAM;YAAmB;SACrD;IACH;CACD;AAGM,SAAS,aAAa,IAAI,EAAE,IAAI;QAWjC,kBACA;IAXJ,IAAI,CAAC,MAAM,OAAO;IAClB,IAAI,IAAA,6HAAO,EAAC,OAAO,OAAO;IAE1B,MAAM,OAAO,IAAA,8HAAQ,EAAC;IACtB,IAAI,CAAC,MAAM,OAAO;IAElB,MAAM,EAAE,UAAU,CAAC,CAAC,EAAE,GAAG;IACzB,MAAM,QAAQ,IAAA,mIAAa,EAAC;IAC5B,MAAM,OAAQ,IAAA,8HAAQ,EAAC;IAEvB,IAAI,EAAA,mBAAA,QAAQ,OAAO,cAAf,uCAAA,iBAAiB,MAAM,KAAI,CAAC,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAA,IAAK,MAAM,GAAG,CAAC,OAAO,GAAG,WAAW,MAAM,OAAO;IACtG,IAAI,EAAA,mBAAA,QAAQ,OAAO,cAAf,uCAAA,iBAAiB,MAAM,KAAI,CAAC,QAAQ,OAAO,CAAC,KAAK,CAAC,CAAA,IAAK,MAAM,GAAG,CAAC,OAAO,GAAG,WAAW,MAAM,OAAO;IACvG,IAAI,QAAQ,OAAO,EAAE;QACnB,MAAM,OAAO,gIAAU,CAAC,OAAO,QAAQ,OAAO,EAAE,WAAW,GAAG,IAAI;QAClE,IAAI,OAAO,MAAM,OAAO;IAC1B;IACA,OAAO;AACT;AAEO,SAAS,aAAa,IAAI,EAAE,KAAK;IACtC,OAAO,CAAC,SAAS,EAAE,EAAE,MAAM,CAAC,CAAA,KAAM,aAAa,GAAG,IAAI,EAAE;AAC1D;AAEO,SAAS,kBAAkB,IAAI;IACpC,OAAO,kBACJ,MAAM,CAAC,CAAA,MAAO,aAAa,IAAI,QAAQ,EAAE,OACzC,GAAG,CAAC,CAAA,MAAO,CAAC;YAAE,GAAG,GAAG;YAAE,OAAO,aAAa,MAAM,IAAI,KAAK;QAAE,CAAC,GAC5D,MAAM,CAAC,CAAA,MAAO,IAAI,KAAK,CAAC,MAAM,GAAG;AACtC","debugId":null}},
    {"offset": {"line": 1066, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/layout/navbar/NavLinks.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { useState, useRef, useCallback } from \"react\";\r\nimport { DesktopNavItem } from \"./NavItem\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useAuth } from \"@/components/local-auth\";\r\nimport { BASE_LINKS, visibleCategories } from \"@/config/routes\";\r\nimport { ChevronDown } from \"lucide-react\";\r\n\r\nexport function NavLinks() {\r\n  const { user } = useAuth();\r\n  const categories = visibleCategories(user);\r\n\r\n  return (\r\n    <div className=\"ml-10 flex items-center gap-6\">\r\n      {BASE_LINKS.map((item) => (\r\n        <DesktopNavItem key={item.href} item={item} />\r\n      ))}\r\n\r\n      {categories.map((cat) => (\r\n        <CategoryDropdown key={cat.id} category={cat} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CategoryDropdown({ category }) {\r\n  const [open, setOpen] = useState(false);\r\n  const closeTimer = useRef(null);\r\n  const menuId = `${category.id}-menu`;\r\n\r\n  const handleOpen = useCallback(() => {\r\n    if (closeTimer.current) clearTimeout(closeTimer.current);\r\n    setOpen(true);\r\n  }, []);\r\n  const handleClose = useCallback(() => {\r\n    if (closeTimer.current) clearTimeout(closeTimer.current);\r\n    closeTimer.current = setTimeout(() => setOpen(false), 120);\r\n  }, []);\r\n  const toggle = useCallback(() => setOpen((v) => !v), []);\r\n\r\n  const Icon = category.icon;\r\n\r\n  return (\r\n    <div\r\n      className=\"relative\"\r\n      onMouseEnter={handleOpen}\r\n      onMouseLeave={handleClose}\r\n      onFocus={handleOpen}\r\n      onBlur={handleClose}\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={toggle}\r\n        aria-haspopup=\"menu\"\r\n        aria-expanded={open}\r\n        aria-controls={menuId}\r\n        className={cn(\r\n          \"relative flex items-center gap-1 transition group\",\r\n          \"text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white\"\r\n        )}\r\n      >\r\n        {Icon ? <Icon className=\"h-4 w-4\" /> : null}\r\n        {category.label}\r\n        <ChevronDown className={`h-4 w-4 transition-transform ${open ? \"rotate-180\" : \"\"}`} />\r\n      </button>\r\n\r\n      <div\r\n        id={menuId}\r\n        role=\"menu\"\r\n        className={`absolute left-0 z-50 mt-2 min-w-[200px] rounded-xl border bg-white shadow-lg ring-1 ring-black/5 dark:bg-neutral-900 dark:border-white/10 dark:ring-white/10 transition-all duration-150\r\n        ${open ? \"opacity-100 translate-y-0\" : \"pointer-events-none -translate-y-1 opacity-0\"}`}\r\n      >\r\n        {category.links.map((it) => (\r\n          <Link\r\n            key={it.href}\r\n            href={it.href}\r\n            role=\"menuitem\"\r\n            className=\"flex items-center gap-2 px-3 py-2 text-sm text-neutral-800 hover:bg-neutral-50 focus:bg-neutral-50 focus:outline-none dark:text-neutral-200 dark:hover:bg-white/5 dark:focus:bg-white/5\"\r\n          >\r\n            {it.icon ? <it.icon className=\"h-4 w-4\" /> : null}\r\n            <span>{it.label}</span>\r\n          </Link>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;AAUO,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,0IAAO;IACxB,MAAM,aAAa,IAAA,wIAAiB,EAAC;IAErC,qBACE,6LAAC;QAAI,WAAU;;YACZ,iIAAU,CAAC,GAAG,CAAC,CAAC,qBACf,6LAAC,+JAAc;oBAAiB,MAAM;mBAAjB,KAAK,IAAI;;;;;YAG/B,WAAW,GAAG,CAAC,CAAC,oBACf,6LAAC;oBAA8B,UAAU;mBAAlB,IAAI,EAAE;;;;;;;;;;;AAIrC;GAfgB;;QACG,0IAAO;;;KADV;AAiBhB,SAAS,iBAAiB,KAAY;QAAZ,EAAE,QAAQ,EAAE,GAAZ;;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,aAAa,IAAA,uKAAM,EAAC;IAC1B,MAAM,SAAS,AAAC,GAAc,OAAZ,SAAS,EAAE,EAAC;IAE9B,MAAM,aAAa,IAAA,4KAAW;oDAAC;YAC7B,IAAI,WAAW,OAAO,EAAE,aAAa,WAAW,OAAO;YACvD,QAAQ;QACV;mDAAG,EAAE;IACL,MAAM,cAAc,IAAA,4KAAW;qDAAC;YAC9B,IAAI,WAAW,OAAO,EAAE,aAAa,WAAW,OAAO;YACvD,WAAW,OAAO,GAAG;6DAAW,IAAM,QAAQ;4DAAQ;QACxD;oDAAG,EAAE;IACL,MAAM,SAAS,IAAA,4KAAW;gDAAC,IAAM;wDAAQ,CAAC,IAAM,CAAC;;+CAAI,EAAE;IAEvD,MAAM,OAAO,SAAS,IAAI;IAE1B,qBACE,6LAAC;QACC,WAAU;QACV,cAAc;QACd,cAAc;QACd,SAAS;QACT,QAAQ;;0BAER,6LAAC;gBACC,MAAK;gBACL,SAAS;gBACT,iBAAc;gBACd,iBAAe;gBACf,iBAAe;gBACf,WAAW,IAAA,qHAAE,EACX,qDACA;;oBAGD,qBAAO,6LAAC;wBAAK,WAAU;;;;;+BAAe;oBACtC,SAAS,KAAK;kCACf,6LAAC,sOAAW;wBAAC,WAAW,AAAC,gCAAwD,OAAzB,OAAO,eAAe;;;;;;;;;;;;0BAGhF,6LAAC;gBACC,IAAI;gBACJ,MAAK;gBACL,WAAW,AAAC,qMAC0E,OAApF,OAAO,8BAA8B;0BAEtC,SAAS,KAAK,CAAC,GAAG,CAAC,CAAC,mBACnB,6LAAC,0KAAI;wBAEH,MAAM,GAAG,IAAI;wBACb,MAAK;wBACL,WAAU;;4BAET,GAAG,IAAI,iBAAG,6LAAC,GAAG,IAAI;gCAAC,WAAU;;;;;uCAAe;0CAC7C,6LAAC;0CAAM,GAAG,KAAK;;;;;;;uBANV,GAAG,IAAI;;;;;;;;;;;;;;;;AAYxB;IA7DS;MAAA","debugId":null}},
    {"offset": {"line": 1237, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/layout/navbar/AvatarButton.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { useEffect, useRef, useState, useCallback, useMemo } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { UserRound } from \"lucide-react\";\r\n\r\nfunction initialsFrom(name, email) {\r\n  const src = (name && name.trim()) || (email && email.split(\"@\")[0]) || \"\";\r\n  if (!src) return \"?\";\r\n  const parts = src.split(/\\s+/).filter(Boolean);\r\n  const pick = parts.length >= 2 ? parts[0][0] + parts[parts.length - 1][0] : src.slice(0, 2);\r\n  return pick.toUpperCase();\r\n}\r\n\r\nexport default function AvatarButton({\r\n  href = \"/me\",\r\n  name,\r\n  email,\r\n  photo,\r\n  fetchUrl = null,\r\n  onClick,\r\n  className,\r\n  fallback = \"icon\",\r\n  version,\r\n}) {\r\n  const [autoPhoto, setAutoPhoto] = useState(null);\r\n  const [imgError, setImgError] = useState(false);\r\n\r\n  const currentBlobUrl = useRef(null);\r\n  const urlsToRevoke = useRef([]);\r\n\r\n  // ทำ URL สำหรับ cache-busting\r\n  const photoWithTs = useMemo(() => {\r\n    if (!photo) return null;\r\n    try {\r\n      const u = new URL(photo, typeof window !== \"undefined\" ? window.location.origin : \"http://localhost\");\r\n      if (version) u.searchParams.set(\"ts\", String(version));\r\n      return u.toString();\r\n    } catch {\r\n      const hasQ = photo.includes(\"?\");\r\n      return version ? `${photo}${hasQ ? \"&\" : \"?\"}ts=${encodeURIComponent(String(version))}` : photo;\r\n    }\r\n  }, [photo, version]);\r\n\r\n  // โหลดรูปอัตโนมัติ (ต้องใช้ fetch เป็น blob เพื่อส่ง cookies ไปด้วย)\r\n  useEffect(() => {\r\n    let aborted = false;\r\n    const ctrl = new AbortController();\r\n\r\n    async function load() {\r\n      setImgError(false);\r\n      if (photoWithTs || !fetchUrl) return;\r\n\r\n      try {\r\n        const hasQ = fetchUrl.includes(\"?\");\r\n        const url = `${fetchUrl}${version ? `${hasQ ? \"&\" : \"?\"}ts=${encodeURIComponent(String(version))}` : \"\"}`;\r\n\r\n        const r = await fetch(url, {\r\n          signal: ctrl.signal,\r\n          cache: \"no-store\",\r\n          credentials: \"include\",\r\n        });\r\n        if (!r.ok) { setImgError(true); return; }\r\n\r\n        const ct = r.headers.get(\"content-type\") || \"\";\r\n        if (!ct.toLowerCase().startsWith(\"image/\")) { setImgError(true); return; }\r\n\r\n        const b = await r.blob();\r\n        if (aborted) return;\r\n        const blobUrl = URL.createObjectURL(b);\r\n\r\n        if (currentBlobUrl.current) urlsToRevoke.current.push(currentBlobUrl.current);\r\n        currentBlobUrl.current = blobUrl;\r\n        setAutoPhoto(blobUrl);\r\n      } catch {\r\n        if (!aborted) setImgError(true);\r\n      }\r\n    }\r\n\r\n    load();\r\n\r\n    return () => {\r\n      aborted = true;\r\n      ctrl.abort();\r\n      if (currentBlobUrl.current) {\r\n        urlsToRevoke.current.push(currentBlobUrl.current);\r\n        currentBlobUrl.current = null;\r\n      }\r\n      while (urlsToRevoke.current.length) {\r\n        const u = urlsToRevoke.current.pop();\r\n        try { URL.revokeObjectURL(u); } catch {}\r\n      }\r\n    };\r\n  }, [photoWithTs, fetchUrl, version]);\r\n\r\n  const resolved = !imgError ? (photoWithTs ?? autoPhoto) : null;\r\n  const isBlob = typeof resolved === \"string\" && resolved.startsWith(\"blob:\");\r\n  const showIconFallback = !resolved && fallback === \"icon\";\r\n\r\n  const handleLoaded = useCallback(() => {\r\n    while (urlsToRevoke.current.length) {\r\n      const u = urlsToRevoke.current.pop();\r\n      try { URL.revokeObjectURL(u); } catch {}\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <Link\r\n      href={href}\r\n      onClick={onClick}\r\n      aria-label=\"Open account page\"\r\n      title={name || email || \"Account\"}\r\n      className={cn(\r\n        \"relative inline-flex h-9 w-9 items-center justify-center overflow-hidden rounded-full\",\r\n        \"ring-offset-2 hover:ring-2 ring-black dark:ring-white dark:ring-offset-black\",\r\n        \"bg-neutral-200 text-neutral-700 dark:bg-neutral-800 dark:text-neutral-200\",\r\n        className\r\n      )}\r\n    >\r\n      {resolved ? (\r\n        isBlob ? (\r\n          <img\r\n            src={resolved}\r\n            alt={name || email || \"avatar\"}\r\n            className=\"h-full w-full object-cover\"\r\n            referrerPolicy=\"no-referrer\"\r\n            crossOrigin=\"anonymous\"\r\n            onLoad={handleLoaded}\r\n            onError={() => setImgError(true)}\r\n          />\r\n        ) : (\r\n          <Image\r\n            src={resolved}\r\n            alt={name || email || \"avatar\"}\r\n            className=\"h-full w-full object-cover\"\r\n            fill\r\n            sizes=\"36px\"\r\n            priority\r\n            unoptimized\r\n            referrerPolicy=\"no-referrer\"\r\n            onLoadingComplete={handleLoaded}\r\n            onError={() => setImgError(true)}\r\n          />\r\n        )\r\n      ) : showIconFallback ? (\r\n        <UserRound className=\"h-5 w-5 opacity-80\" aria-hidden=\"true\" />\r\n      ) : (\r\n        <span className=\"select-none text-xs font-semibold\">\r\n          {initialsFrom(name, email)}\r\n        </span>\r\n      )}\r\n    </Link>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1422, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/layout/navbar/MobileMenu.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { usePathname, useRouter } from \"next/navigation\";\r\nimport { useState } from \"react\";\r\nimport AvatarButton from \"./AvatarButton\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport StatefulButton from \"@/components/ui/stateful-button\";\r\nimport ThemeToggle from \"@/components/ui/ThemeToggle\";\r\nimport { useAuth } from \"@/components/local-auth\";\r\nimport { BASE_LINKS, visibleCategories } from \"@/config/routes\";\r\nimport { ChevronDown } from \"lucide-react\";\r\nimport { MobileNavItem } from \"./NavItem\";\r\n\r\nexport function MobileMenu({ open, onClose }) {\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const { user, loading, signOut } = useAuth();\r\n  const categories = visibleCategories(user);\r\n\r\n  const [openId, setOpenId] = useState(null);\r\n  const toggle = (id) => setOpenId((v) => (v === id ? null : id));\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        initial={{ opacity: 0, height: 0, y: -6 }}\r\n        animate={{ opacity: 1, height: \"auto\", y: 0 }}\r\n        exit={{ opacity: 0, height: 0, y: -6 }}\r\n        transition={{ duration: 0.22 }}\r\n        className=\"lg:hidden z-[55] overflow-hidden bg-white dark:bg-neutral-900 shadow-xl border border-black/10 dark:border-white/10 rounded-2xl mx-3 mt-2\"\r\n      >\r\n        <div className=\"flex flex-col p-4 gap-1\">\r\n          {BASE_LINKS.map((item) => (\r\n            <MobileNavItem key={item.href} item={item} onClick={onClose} />\r\n          ))}\r\n\r\n          {categories.map((cat) => (\r\n            <CategoryGroup\r\n              key={cat.id}\r\n              category={cat}\r\n              open={openId === cat.id}\r\n              onToggle={() => toggle(cat.id)}\r\n              onItemClick={onClose}\r\n            />\r\n          ))}\r\n\r\n          <div className=\"my-2 h-px bg-black/10 dark:bg-white/10\" />\r\n\r\n          <div className=\"mt-2 space-y-3\">\r\n            <div className=\"flex flex-col gap-3 rounded-xl bg-black/5 px-3 py-2 dark:bg-white/5\">\r\n              {user && (\r\n                <div className=\"flex items-center gap-3\">\r\n                  <AvatarButton\r\n                    name={user?.name}\r\n                    email={user?.email}\r\n                    fetchUrl={user?.id ? `/profile/files/user/avatar/${user.id}` : undefined}\r\n                    onClick={onClose}\r\n                  />\r\n                  <div className=\"min-w-0\">\r\n                    <Link\r\n                      href=\"/profile\"\r\n                      onClick={onClose}\r\n                      className=\"block truncate text-sm font-medium text-gray-900 hover:underline dark:text-gray-100\"\r\n                    >\r\n                      {user.name || user.email}\r\n                    </Link>\r\n                    <div className=\"truncate text-xs text-gray-500 dark:text-gray-400\">\r\n                      Account\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"truncate text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                {user ? user.email : \"พร้อมใช้งาน\"}\r\n              </div>\r\n\r\n              {loading ? (\r\n                <div className=\"h-9 w-full animate-pulse rounded-full bg-black/10 dark:bg-white/10\" />\r\n              ) : user ? (\r\n                <StatefulButton\r\n                  className=\"h-9 w-full rounded-full\"\r\n                  loadingText=\"Signing out...\"\r\n                  onClick={() =>\r\n                    signOut().then(() => {\r\n                      onClose();\r\n                      router.push(\"/login\");\r\n                    })\r\n                  }\r\n                >\r\n                  Sign Out\r\n                </StatefulButton>\r\n              ) : (\r\n                <Button\r\n                  className=\"h-9 w-full rounded-full\"\r\n                  onClick={() => {\r\n                    onClose();\r\n                    router.push(`/login?callbackUrl=${encodeURIComponent(pathname || \"/\")}`);\r\n                  }}\r\n                >\r\n                  Get Started\r\n                </Button>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"px-3\">\r\n              <ThemeToggle />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"h-3\" style={{ paddingBottom: \"env(safe-area-inset-bottom)\" }} />\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\nfunction CategoryGroup({ category, open, onToggle, onItemClick }) {\r\n  const Icon = category.icon;\r\n  return (\r\n    <>\r\n      <button\r\n        type=\"button\"\r\n        aria-expanded={open}\r\n        aria-controls={`${category.id}-group`}\r\n        onClick={onToggle}\r\n        className=\"flex w-full items-center justify-between rounded-md px-3 py-2.5 text-left text-gray-700 hover:bg-black/5 dark:text-gray-300 dark:hover:bg:white/5 dark:hover:bg-white/5\"\r\n      >\r\n        <span className=\"flex items-center gap-3\">\r\n          {Icon ? <Icon className=\"h-5 w-5\" /> : null}\r\n        {category.label}\r\n        </span>\r\n        <ChevronDown className={`h-4 w-4 transition-transform ${open ? \"rotate-180\" : \"\"}`} />\r\n      </button>\r\n\r\n      <AnimatePresence initial={false}>\r\n        {open && (\r\n          <motion.div\r\n            id={`${category.id}-group`}\r\n            initial={{ height: 0, opacity: 0 }}\r\n            animate={{ height: \"auto\", opacity: 1 }}\r\n            exit={{ height: 0, opacity: 0 }}\r\n            transition={{ duration: 0.18 }}\r\n            className=\"overflow-hidden\"\r\n          >\r\n            <div className=\"ml-8 mt-1 flex flex-col gap-1 border-l border-black/10 pl-3 dark:border-white/10\">\r\n              {category.links.map((it) => (\r\n                <Link\r\n                  key={it.href}\r\n                  href={it.href}\r\n                  onClick={onItemClick}\r\n                  className=\"flex items-center gap-3 rounded-md px-3 py-2.5 text-gray-700 hover:bg-black/5 dark:text-gray-300 dark:hover:bg-white/5\"\r\n                >\r\n                  {it.icon ? <it.icon className=\"h-5 w-5\" /> : null}\r\n                  {it.label}\r\n                </Link>\r\n              ))}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1777, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/modal/Modal.jsx"],"sourcesContent":["\"use client\";\r\nimport * as React from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\n\r\nconst SIZES = {\r\n  sm: \"max-w-sm\",\r\n  md: \"max-w-md\",\r\n  lg: \"max-w-lg\",\r\n  xl: \"max-w-2xl\",\r\n  fullscreen: \"max-w-[96vw] h-[96vh]\",\r\n};\r\n\r\nexport default function Modal({\r\n  open,\r\n  title,\r\n  children,\r\n  onClose,\r\n  size = \"lg\", // <-- มาตรฐาน\r\n  footer = null, // <-- เพิ่ม footer slot\r\n  dismissable = true, // <-- คลิกฉากหลังเพื่อปิด\r\n}) {\r\n  const [mounted, setMounted] = React.useState(false);\r\n  React.useEffect(() => setMounted(true), []);\r\n\r\n  if (!mounted || !open) return null;\r\n\r\n  const node = (\r\n    <div\r\n      className=\"fixed inset-0 z-[1000] flex items-center justify-center\"\r\n      aria-modal=\"true\"\r\n      role=\"dialog\"\r\n    >\r\n      {/* Overlay */}\r\n      <div\r\n        className=\"absolute inset-0 bg-black/40 dark:bg-black/60\"\r\n        onClick={dismissable ? onClose : undefined}\r\n        aria-hidden\r\n      />\r\n      {/* Panel */}\r\n      <div\r\n        className={[\r\n          \"relative mx-4 w-full\",\r\n          SIZES[size] || SIZES.lg,\r\n          \"rounded-2xl border shadow-xl\",\r\n          \"bg-white text-neutral-900 border-neutral-200\",\r\n          \"dark:bg-neutral-900 dark:text-neutral-100 dark:border-neutral-700\",\r\n        ].join(\" \")}\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header */}\r\n        {(title || onClose) && (\r\n          <div className=\"flex items-center justify-between gap-4 px-5 pt-4\">\r\n            <h3 className=\"text-base font-semibold\">{title}</h3>\r\n            {onClose && (\r\n              <button\r\n                onClick={onClose}\r\n                className=\"rounded-md px-2 py-1 text-sm text-neutral-600 hover:bg-neutral-100\r\n                           dark:text-neutral-300 dark:hover:bg-neutral-800\"\r\n                aria-label=\"ปิด\"\r\n              >\r\n                ปิด\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n        {/* Body */}\r\n        <div className=\"px-5 py-4\">{children}</div>\r\n        {/* Footer */}\r\n        {footer && (\r\n          <div className=\"flex items-center justify-end gap-2 px-5 pb-4\">\r\n            {footer}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const root = typeof window !== \"undefined\" ? document.body : null;\r\n  return root ? createPortal(node, root) : node;\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIA,MAAM,QAAQ;IACZ,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,YAAY;AACd;AAEe,SAAS,MAAM,KAQ7B;QAR6B,EAC5B,IAAI,EACJ,KAAK,EACL,QAAQ,EACR,OAAO,EACP,OAAO,IAAI,EACX,SAAS,IAAI,EACb,cAAc,IAAI,EACnB,GAR6B;;IAS5B,MAAM,CAAC,SAAS,WAAW,GAAG,yKAAc,CAAC;IAC7C,0KAAe;2BAAC,IAAM,WAAW;0BAAO,EAAE;IAE1C,IAAI,CAAC,WAAW,CAAC,MAAM,OAAO;IAE9B,MAAM,qBACJ,6LAAC;QACC,WAAU;QACV,cAAW;QACX,MAAK;;0BAGL,6LAAC;gBACC,WAAU;gBACV,SAAS,cAAc,UAAU;gBACjC,aAAW;;;;;;0BAGb,6LAAC;gBACC,WAAW;oBACT;oBACA,KAAK,CAAC,KAAK,IAAI,MAAM,EAAE;oBACvB;oBACA;oBACA;iBACD,CAAC,IAAI,CAAC;gBACP,SAAS,CAAC,IAAM,EAAE,eAAe;;oBAGhC,CAAC,SAAS,OAAO,mBAChB,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAG,WAAU;0CAA2B;;;;;;4BACxC,yBACC,6LAAC;gCACC,SAAS;gCACT,WAAU;gCAEV,cAAW;0CACZ;;;;;;;;;;;;kCAOP,6LAAC;wBAAI,WAAU;kCAAa;;;;;;oBAE3B,wBACC,6LAAC;wBAAI,WAAU;kCACZ;;;;;;;;;;;;;;;;;;IAOX,MAAM,OAAO,uCAAgC,SAAS,IAAI,GAAG;IAC7D,OAAO,qBAAO,IAAA,oLAAY,EAAC,MAAM,QAAQ;AAC3C;GAnEwB;KAAA","debugId":null}},
    {"offset": {"line": 1897, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/modal/ConfirmDialog.jsx"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\nimport Modal from \"@/components/modal/Modal\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nexport default function ConfirmDialog({\r\n  open,\r\n  title = \"ยืนยันการทำรายการ\",\r\n  description,\r\n  confirmText = \"ยืนยัน\",\r\n  cancelText = \"ยกเลิก\",\r\n  loading = false,\r\n  error,\r\n  onCancel,\r\n  onConfirm,\r\n}) {\r\n  return (\r\n    <Modal\r\n      open={open}\r\n      onClose={onCancel}\r\n      title={title}\r\n      size=\"md\"\r\n      footer={\r\n        <>\r\n          <Button variant=\"outline\" onClick={onCancel} disabled={loading}>\r\n            {cancelText}\r\n          </Button>\r\n          <Button\r\n            onClick={onConfirm}\r\n            disabled={loading}\r\n            aria-busy={loading || undefined}\r\n          >\r\n            {loading ? \"กำลังดำเนินการ…\" : confirmText}\r\n          </Button>\r\n        </>\r\n      }\r\n    >\r\n      {description && (\r\n        <p className=\"text-sm text-neutral-700 dark:text-neutral-300\">\r\n          {description}\r\n        </p>\r\n      )}\r\n      {error && (\r\n        <div\r\n          className=\"mt-3 rounded border px-3 py-2 text-sm\r\n                        border-red-300 bg-red-50 text-red-800\r\n                        dark:border-red-700 dark:bg-red-900 dark:text-red-100\"\r\n        >\r\n          {error}\r\n        </div>\r\n      )}\r\n    </Modal>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAHA;;;;;AAKe,SAAS,cAAc,KAUrC;QAVqC,EACpC,IAAI,EACJ,QAAQ,mBAAmB,EAC3B,WAAW,EACX,cAAc,QAAQ,EACtB,aAAa,QAAQ,EACrB,UAAU,KAAK,EACf,KAAK,EACL,QAAQ,EACR,SAAS,EACV,GAVqC;IAWpC,qBACE,6LAAC,2IAAK;QACJ,MAAM;QACN,SAAS;QACT,OAAO;QACP,MAAK;QACL,sBACE;;8BACE,6LAAC,wIAAM;oBAAC,SAAQ;oBAAU,SAAS;oBAAU,UAAU;8BACpD;;;;;;8BAEH,6LAAC,wIAAM;oBACL,SAAS;oBACT,UAAU;oBACV,aAAW,WAAW;8BAErB,UAAU,oBAAoB;;;;;;;;;YAKpC,6BACC,6LAAC;gBAAE,WAAU;0BACV;;;;;;YAGJ,uBACC,6LAAC;gBACC,WAAU;0BAIT;;;;;;;;;;;;AAKX;KAhDwB","debugId":null}},
    {"offset": {"line": 1975, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/hooks/useConfirm.js"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\nimport ConfirmDialog from \"../components/modal/ConfirmDialog\";\r\n\r\nexport function useConfirm() {\r\n  const [state, setState] = React.useState({\r\n    open: false,\r\n    title: \"\",\r\n    description: \"\",\r\n    confirmText: \"ยืนยัน\",\r\n    cancelText: \"ยกเลิก\",\r\n    loading: false,\r\n    error: null,\r\n    resolve: null,\r\n  });\r\n\r\n  const confirm = React.useCallback((opts = {}) => {\r\n    return new Promise((resolve) => {\r\n      setState((s) => ({\r\n        ...s,\r\n        open: true,\r\n        resolve,\r\n        ...opts,\r\n        loading: false,\r\n        error: null,\r\n      }));\r\n    });\r\n  }, []);\r\n\r\n  const handleCancel = () => {\r\n    state.resolve?.(false);\r\n    setState((s) => ({ ...s, open: false }));\r\n  };\r\n\r\n  const handleConfirm = async () => {\r\n    if (!state.onConfirm) {\r\n      state.resolve?.(true);\r\n      setState((s) => ({ ...s, open: false }));\r\n      return;\r\n    }\r\n    try {\r\n      setState((s) => ({ ...s, loading: true, error: null }));\r\n      await state.onConfirm();\r\n      state.resolve?.(true);\r\n      setState((s) => ({ ...s, open: false, loading: false }));\r\n    } catch (e) {\r\n      setState((s) => ({\r\n        ...s,\r\n        loading: false,\r\n        error: e instanceof Error ? e.message : String(e || \"เกิดข้อผิดพลาด\"),\r\n      }));\r\n    }\r\n  };\r\n\r\n  const dialog = (\r\n    <ConfirmDialog\r\n      open={state.open}\r\n      title={state.title}\r\n      description={state.description}\r\n      confirmText={state.confirmText}\r\n      cancelText={state.cancelText}\r\n      loading={state.loading}\r\n      error={state.error}\r\n      onCancel={handleCancel}\r\n      onConfirm={handleConfirm}\r\n    />\r\n  );\r\n\r\n  return { confirm, dialog };\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIO,SAAS;;IACd,MAAM,CAAC,OAAO,SAAS,GAAG,wKAAK,CAAC,QAAQ,CAAC;QACvC,MAAM;QACN,OAAO;QACP,aAAa;QACb,aAAa;QACb,YAAY;QACZ,SAAS;QACT,OAAO;QACP,SAAS;IACX;IAEA,MAAM,UAAU,wKAAK,CAAC,WAAW;2CAAC;gBAAC,wEAAO,CAAC;YACzC,OAAO,IAAI;mDAAQ,CAAC;oBAClB;2DAAS,CAAC,IAAM,CAAC;gCACf,GAAG,CAAC;gCACJ,MAAM;gCACN;gCACA,GAAG,IAAI;gCACP,SAAS;gCACT,OAAO;4BACT,CAAC;;gBACH;;QACF;0CAAG,EAAE;IAEL,MAAM,eAAe;YACnB;SAAA,iBAAA,MAAM,OAAO,cAAb,qCAAA,oBAAA,OAAgB;QAChB,SAAS,CAAC,IAAM,CAAC;gBAAE,GAAG,CAAC;gBAAE,MAAM;YAAM,CAAC;IACxC;IAEA,MAAM,gBAAgB;QACpB,IAAI,CAAC,MAAM,SAAS,EAAE;gBACpB;aAAA,iBAAA,MAAM,OAAO,cAAb,qCAAA,oBAAA,OAAgB;YAChB,SAAS,CAAC,IAAM,CAAC;oBAAE,GAAG,CAAC;oBAAE,MAAM;gBAAM,CAAC;YACtC;QACF;QACA,IAAI;gBAGF;YAFA,SAAS,CAAC,IAAM,CAAC;oBAAE,GAAG,CAAC;oBAAE,SAAS;oBAAM,OAAO;gBAAK,CAAC;YACrD,MAAM,MAAM,SAAS;aACrB,kBAAA,MAAM,OAAO,cAAb,sCAAA,qBAAA,OAAgB;YAChB,SAAS,CAAC,IAAM,CAAC;oBAAE,GAAG,CAAC;oBAAE,MAAM;oBAAO,SAAS;gBAAM,CAAC;QACxD,EAAE,OAAO,GAAG;YACV,SAAS,CAAC,IAAM,CAAC;oBACf,GAAG,CAAC;oBACJ,SAAS;oBACT,OAAO,aAAa,QAAQ,EAAE,OAAO,GAAG,OAAO,KAAK;gBACtD,CAAC;QACH;IACF;IAEA,MAAM,uBACJ,6LAAC,mJAAa;QACZ,MAAM,MAAM,IAAI;QAChB,OAAO,MAAM,KAAK;QAClB,aAAa,MAAM,WAAW;QAC9B,aAAa,MAAM,WAAW;QAC9B,YAAY,MAAM,UAAU;QAC5B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;QAClB,UAAU;QACV,WAAW;;;;;;IAIf,OAAO;QAAE;QAAS;IAAO;AAC3B;GAjEgB","debugId":null}},
    {"offset": {"line": 2086, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/components/layout/navbar/Navbar.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { usePathname, useRouter } from \"next/navigation\";\r\nimport { Menu, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport ThemeToggle from \"@/components/ui/ThemeToggle\";\r\nimport StatefulButton from \"@/components/ui/stateful-button\";\r\nimport { NavLinks } from \"./NavLinks\";\r\nimport AvatarButton from \"./AvatarButton\";\r\nimport { MobileMenu } from \"./MobileMenu\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useAuth } from \"@/components/local-auth\";\r\nimport { useConfirm } from \"@/hooks/useConfirm\";\r\n\r\nexport default function Navbar() {\r\n  const [open, setOpen] = useState(false);\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const { user, loading, signOut } = useAuth();\r\n  const { confirm, dialog } = useConfirm();\r\n\r\n  async function handleSignOut() {\r\n    const ok = await confirm({\r\n      title: \"ออกจากระบบ\",\r\n      description: \"คุณต้องการออกจากระบบใช่ไหม?\",\r\n      confirmText: \"ออกจากระบบ\",\r\n      cancelText: \"ยกเลิก\",\r\n      onConfirm: async () => {\r\n        await signOut();\r\n      },\r\n    });\r\n    if (ok) router.push(\"/login\");\r\n  }\r\n\r\n  return (\r\n    <nav\r\n      className={cn(\r\n        \"fixed top-0 left-0 right-0 z-50\",\r\n        \"backdrop-blur-md shadow-sm\",\r\n        \"bg-gradient-to-r from-white/80 to-gray-100/80 dark:from-black/60 dark:to-gray-900/60\"\r\n      )}\r\n    >\r\n      <div className=\"mx-auto flex h-16 max-w-7xl items-center justify-between px-4 lg:px-8\">\r\n        <Link href=\"/\" className=\"text-xl font-bold\">\r\n          EMP\r\n        </Link>\r\n\r\n        {/* Desktop */}\r\n        <div className=\"hidden lg:flex items-center w-full\">\r\n          <NavLinks />\r\n          <div className=\"ml-auto flex items-center gap-3\">\r\n            {user && (\r\n              <AvatarButton\r\n                name={user?.name}\r\n                email={user?.email}\r\n                fetchUrl={user?.id ? `/api/files/user/avatar/${user.id}` : undefined}\r\n              />\r\n            )}\r\n            <ThemeToggle />\r\n            {loading ? (\r\n              <div className=\"h-9 w-28 animate-pulse rounded-full bg-black/10 dark:bg-white/10\" />\r\n            ) : user ? (\r\n              <StatefulButton\r\n                className=\"h-9 rounded-full\"\r\n                loadingText=\"กำลังออกจากระบบ...\"\r\n                onClick={handleSignOut}\r\n              >\r\n                ออกจากระบบ\r\n              </StatefulButton>\r\n            ) : (\r\n              <Button\r\n                className=\"h-9 rounded-full\"\r\n                onClick={() =>\r\n                  router.push(`/login?callbackUrl=${encodeURIComponent(pathname)}`)\r\n                }\r\n              >\r\n                เข้าสู่ระบบ\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Mobile Toggle */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          onClick={() => setOpen((v) => !v)}\r\n          className=\"lg:hidden p-2 rounded-md hover:bg-gray-100 dark:hover:bg-neutral-800\"\r\n          aria-label=\"Toggle navigation menu\"\r\n        >\r\n          {open ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Mobile Menu */}\r\n      <MobileMenu open={open} onClose={() => setOpen(false)} />\r\n\r\n      {/* โมดัลยืนยัน */}\r\n      {dialog}\r\n    </nav>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAdA;;;;;;;;;;;;;;AAgBe,SAAS;;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,IAAA,0IAAO;IAC1C,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,IAAA,oIAAU;IAEtC,eAAe;QACb,MAAM,KAAK,MAAM,QAAQ;YACvB,OAAO;YACP,aAAa;YACb,aAAa;YACb,YAAY;YACZ,WAAW;gBACT,MAAM;YACR;QACF;QACA,IAAI,IAAI,OAAO,IAAI,CAAC;IACtB;IAEA,qBACE,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,mCACA,8BACA;;0BAGF,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,0KAAI;wBAAC,MAAK;wBAAI,WAAU;kCAAoB;;;;;;kCAK7C,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,0JAAQ;;;;;0CACT,6LAAC;gCAAI,WAAU;;oCACZ,sBACC,6LAAC,6JAAY;wCACX,IAAI,EAAE,iBAAA,2BAAA,KAAM,IAAI;wCAChB,KAAK,EAAE,iBAAA,2BAAA,KAAM,KAAK;wCAClB,UAAU,CAAA,iBAAA,2BAAA,KAAM,EAAE,IAAG,AAAC,0BAAiC,OAAR,KAAK,EAAE,IAAK;;;;;;kDAG/D,6LAAC,8IAAW;;;;;oCACX,wBACC,6LAAC;wCAAI,WAAU;;;;;+CACb,qBACF,6LAAC,qJAAc;wCACb,WAAU;wCACV,aAAY;wCACZ,SAAS;kDACV;;;;;6DAID,6LAAC,wIAAM;wCACL,WAAU;wCACV,SAAS,IACP,OAAO,IAAI,CAAC,AAAC,sBAAkD,OAA7B,mBAAmB;kDAExD;;;;;;;;;;;;;;;;;;kCAQP,6LAAC,wIAAM;wBACL,SAAQ;wBACR,SAAS,IAAM,QAAQ,CAAC,IAAM,CAAC;wBAC/B,WAAU;wBACV,cAAW;kCAEV,qBAAO,6LAAC,oMAAC;4BAAC,WAAU;;;;;iDAAe,6LAAC,6MAAI;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAKxD,6LAAC,8JAAU;gBAAC,MAAM;gBAAM,SAAS,IAAM,QAAQ;;;;;;YAG9C;;;;;;;AAGP;GAtFwB;;QAEL,oJAAW;QACb,kJAAS;QACW,0IAAO;QACd,oIAAU;;;KALhB","debugId":null}}]
}