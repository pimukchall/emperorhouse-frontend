{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/%28app%29/admin/users/components/FiltersBar.jsx"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\n\r\n/** FiltersBar — ใช้คู่กับ AdminUsersPage */\r\nexport default function FiltersBar({ roles = [], departments = [], filters }) {\r\n  const {\r\n    q, setQ,\r\n    roleId, setRoleId,\r\n    departmentId, setDepartmentId,\r\n    includeDeleted, setIncludeDeleted,\r\n    onClear,\r\n  } = filters;\r\n\r\n  const cx = \"mt-1 w-full rounded-md border px-3 py-2 text-sm dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-100\";\r\n\r\n  return (\r\n    <section className=\"rounded-xl border bg-white dark:bg-neutral-900 dark:border-neutral-700 p-4\">\r\n      <div className=\"grid gap-3 sm:grid-cols-6\">\r\n        <label className=\"sm:col-span-2\">\r\n          <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">ค้นหา (ชื่อ/อีเมล/โค้ด)</div>\r\n          <input value={q} onChange={(e) => setQ(e.target.value)} placeholder=\"พิมพ์คำค้น…\" className={cx} />\r\n        </label>\r\n\r\n        <label className=\"sm:col-span-2\">\r\n          <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Role</div>\r\n          <select value={roleId} onChange={(e) => setRoleId(e.target.value)} className={cx}>\r\n            <option value=\"\">ทั้งหมด</option>\r\n            {roles.map((r) => <option key={r.id} value={String(r.id)}>{r.name}</option>)}\r\n          </select>\r\n        </label>\r\n\r\n        <label className=\"sm:col-span-2\">\r\n          <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Department</div>\r\n          <select value={departmentId} onChange={(e) => setDepartmentId(e.target.value)} className={cx}>\r\n            <option value=\"\">ทั้งหมด</option>\r\n            {departments.map((d) => (\r\n              <option key={d.id} value={String(d.id)}>\r\n                {d.code} · {d.nameTh || d.nameEn || `Dept#${d.id}`}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </label>\r\n\r\n        <label className=\"sm:col-span-6 flex items-center gap-2 mt-1\">\r\n          <input type=\"checkbox\" checked={!!includeDeleted} onChange={(e) => setIncludeDeleted(e.target.checked)} className=\"h-4 w-4\" />\r\n          <span className=\"text-sm text-neutral-700 dark:text-neutral-300\">แสดงผู้ใช้ที่ถูกลบ (soft-delete)</span>\r\n        </label>\r\n\r\n        <div className=\"sm:col-span-6 flex gap-2\">\r\n          <button type=\"button\" onClick={onClear} className=\"h-9 px-4 rounded-md border hover:bg-neutral-50 dark:border-neutral-700 dark:hover:bg-neutral-800\">\r\n            ล้างตัวกรอง\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AADA;;;AAIe,SAAS,WAAW,KAAyC;QAAzC,EAAE,QAAQ,EAAE,EAAE,cAAc,EAAE,EAAE,OAAO,EAAE,GAAzC;IACjC,MAAM,EACJ,CAAC,EAAE,IAAI,EACP,MAAM,EAAE,SAAS,EACjB,YAAY,EAAE,eAAe,EAC7B,cAAc,EAAE,iBAAiB,EACjC,OAAO,EACR,GAAG;IAEJ,MAAM,KAAK;IAEX,qBACE,6LAAC;QAAQ,WAAU;kBACjB,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAM,WAAU;;sCACf,6LAAC;4BAAI,WAAU;sCAAiD;;;;;;sCAChE,6LAAC;4BAAM,OAAO;4BAAG,UAAU,CAAC,IAAM,KAAK,EAAE,MAAM,CAAC,KAAK;4BAAG,aAAY;4BAAc,WAAW;;;;;;;;;;;;8BAG/F,6LAAC;oBAAM,WAAU;;sCACf,6LAAC;4BAAI,WAAU;sCAAiD;;;;;;sCAChE,6LAAC;4BAAO,OAAO;4BAAQ,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;4BAAG,WAAW;;8CAC5E,6LAAC;oCAAO,OAAM;8CAAG;;;;;;gCAChB,MAAM,GAAG,CAAC,CAAC,kBAAM,6LAAC;wCAAkB,OAAO,OAAO,EAAE,EAAE;kDAAI,EAAE,IAAI;uCAAlC,EAAE,EAAE;;;;;;;;;;;;;;;;;8BAIvC,6LAAC;oBAAM,WAAU;;sCACf,6LAAC;4BAAI,WAAU;sCAAiD;;;;;;sCAChE,6LAAC;4BAAO,OAAO;4BAAc,UAAU,CAAC,IAAM,gBAAgB,EAAE,MAAM,CAAC,KAAK;4BAAG,WAAW;;8CACxF,6LAAC;oCAAO,OAAM;8CAAG;;;;;;gCAChB,YAAY,GAAG,CAAC,CAAC,kBAChB,6LAAC;wCAAkB,OAAO,OAAO,EAAE,EAAE;;4CAClC,EAAE,IAAI;4CAAC;4CAAI,EAAE,MAAM,IAAI,EAAE,MAAM,IAAI,AAAC,QAAY,OAAL,EAAE,EAAE;;uCADrC,EAAE,EAAE;;;;;;;;;;;;;;;;;8BAOvB,6LAAC;oBAAM,WAAU;;sCACf,6LAAC;4BAAM,MAAK;4BAAW,SAAS,CAAC,CAAC;4BAAgB,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,OAAO;4BAAG,WAAU;;;;;;sCAClH,6LAAC;4BAAK,WAAU;sCAAiD;;;;;;;;;;;;8BAGnE,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAO,MAAK;wBAAS,SAAS;wBAAS,WAAU;kCAAmG;;;;;;;;;;;;;;;;;;;;;;AAO/J;KApDwB","debugId":null}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/%28app%29/admin/users/components/UserForm.jsx"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\n\r\nconst EMPLOYEE_TYPES = [\r\n  { value: \"\", label: \"- ไม่ระบุ -\" },\r\n  { value: \"DAILY\", label: \"DAILY (รายวัน)\" },\r\n  { value: \"MONTHLY\", label: \"MONTHLY (รายเดือน)\" },\r\n];\r\nconst CONTRACT_TYPES = [\r\n  { value: \"\", label: \"- ไม่ระบุ -\" },\r\n  { value: \"PERMANENT\", label: \"PERMANENT (ประจำ)\" },\r\n  { value: \"TEMPORARY\", label: \"TEMPORARY (ชั่วคราว)\" },\r\n  { value: \"PROBATION\", label: \"PROBATION (ทดลองงาน)\" },\r\n];\r\nconst GENDERS = [\r\n  { value: \"\", label: \"- ไม่ระบุ -\" },\r\n  { value: \"MALE\", label: \"ชาย\" },\r\n  { value: \"FEMALE\", label: \"หญิง\" },\r\n  { value: \"OTHER\", label: \"อื่น ๆ\" },\r\n];\r\n\r\nexport default function UserForm({\r\n  roles = [],\r\n  departments = [],\r\n  organizations = [],\r\n  form,\r\n  setForm,\r\n  isEditing,\r\n  onSubmit,\r\n  onCancel,\r\n  canSubmit = true,\r\n}) {\r\n  const hasCurrentOrg = form.orgId && organizations.some((o) => String(o.id) === String(form.orgId));\r\n  const cx = \"mt-1 w-full rounded-md border px-3 py-2 text-sm dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-100\";\r\n  const note = \"text-[11px] text-neutral-500 dark:text-neutral-400 mt-1\";\r\n\r\n  const needPassword = !isEditing;\r\n\r\n  const emailInvalid = !form.email;\r\n  const passwordInvalid = needPassword && (!form.password || form.password.length < 8);\r\n  const roleInvalid = !form.roleId;\r\n  const deptInvalid = !form.departmentId;\r\n\r\n  return (\r\n    <form className=\"grid gap-3 sm:grid-cols-3\" onSubmit={onSubmit}>\r\n      {/* Login */}\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">อีเมล <span className=\"text-rose-600\">*</span></div>\r\n        <input value={form.email} onChange={(e) => setForm({ ...form, email: e.target.value })} className={cx} required />\r\n        {emailInvalid && <div className={note}>ต้องกรอกอีเมล</div>}\r\n      </label>\r\n\r\n      {needPassword && (\r\n        <label className=\"block\">\r\n          <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">รหัสผ่านเริ่มต้น <span className=\"text-rose-600\">*</span></div>\r\n          <input type=\"password\" value={form.password} onChange={(e) => setForm({ ...form, password: e.target.value })} className={cx} placeholder=\"อย่างน้อย 8 ตัว\" required />\r\n          {passwordInvalid && <div className={note}>อย่างน้อย 8 ตัวอักษร</div>}\r\n        </label>\r\n      )}\r\n\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">ชื่อที่แสดง (nickname)</div>\r\n        <input value={form.name} onChange={(e) => setForm({ ...form, name: e.target.value })} className={cx} />\r\n      </label>\r\n\r\n      {/* ชื่อ */}\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">ชื่อ (ไทย)</div>\r\n        <input value={form.firstNameTh} onChange={(e) => setForm({ ...form, firstNameTh: e.target.value })} className={cx} />\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">นามสกุล (ไทย)</div>\r\n        <input value={form.lastNameTh} onChange={(e) => setForm({ ...form, lastNameTh: e.target.value })} className={cx} />\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">ชื่อ (อังกฤษ)</div>\r\n        <input value={form.firstNameEn} onChange={(e) => setForm({ ...form, firstNameEn: e.target.value })} className={cx} />\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">นามสกุล (อังกฤษ)</div>\r\n        <input value={form.lastNameEn} onChange={(e) => setForm({ ...form, lastNameEn: e.target.value })} className={cx} />\r\n      </label>\r\n\r\n      {/* HR */}\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Employee Code</div>\r\n        <input value={form.employeeCode} onChange={(e) => setForm({ ...form, employeeCode: e.target.value })} className={cx} placeholder=\"ถ้าเว้นว่าง ระบบจะสร้างให้อัตโนมัติ\" />\r\n      </label>\r\n\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Organization</div>\r\n        <select value={form.orgId ?? \"\"} onChange={(e) => setForm({ ...form, orgId: e.target.value || \"\" })} className={cx}>\r\n          <option value=\"\">- ไม่ระบุ -</option>\r\n          {!hasCurrentOrg && form.orgId && <option value={String(form.orgId)}>{form.orgLabel || `Org#${form.orgId}`}</option>}\r\n          {organizations.map((o) => (\r\n            <option key={o.id} value={String(o.id)}>\r\n              {o.code ? `${o.code} · ` : \"\"}{o.nameTh || o.nameEn || `Org#${o.id}`}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </label>\r\n\r\n      {/* ENUMs */}\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Employee Type</div>\r\n        <select value={form.employeeType ?? \"\"} onChange={(e) => setForm({ ...form, employeeType: e.target.value || \"\" })} className={cx}>\r\n          {EMPLOYEE_TYPES.map((opt) => <option key={opt.value} value={opt.value}>{opt.label}</option>)}\r\n        </select>\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Contract Type</div>\r\n        <select value={form.contractType ?? \"\"} onChange={(e) => setForm({ ...form, contractType: e.target.value || \"\" })} className={cx}>\r\n          {CONTRACT_TYPES.map((opt) => <option key={opt.value} value={opt.value}>{opt.label}</option>)}\r\n        </select>\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Gender</div>\r\n        <select value={form.gender ?? \"\"} onChange={(e) => setForm({ ...form, gender: e.target.value })} className={cx}>\r\n          {GENDERS.map((g) => <option key={g.value} value={g.value}>{g.label}</option>)}\r\n        </select>\r\n      </label>\r\n\r\n      {/* Dates */}\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Birth Date</div>\r\n        <input type=\"date\" value={form.birthDate} onChange={(e) => setForm({ ...form, birthDate: e.target.value })} className={cx} />\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Start Date</div>\r\n        <input type=\"date\" value={form.startDate} onChange={(e) => setForm({ ...form, startDate: e.target.value })} className={cx} />\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Probation End</div>\r\n        <input type=\"date\" value={form.probationEndDate} onChange={(e) => setForm({ ...form, probationEndDate: e.target.value })} className={cx} />\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Resigned At</div>\r\n        <input type=\"date\" value={form.resignedAt} onChange={(e) => setForm({ ...form, resignedAt: e.target.value })} className={cx} />\r\n      </label>\r\n\r\n      {/* role / department — required */}\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Role <span className=\"text-rose-600\">*</span></div>\r\n        <select value={form.roleId} onChange={(e) => setForm({ ...form, roleId: e.target.value })} className={cx} required>\r\n          <option value=\"\">- เลือก -</option>\r\n          {roles.map((r) => <option key={r.id} value={String(r.id)}>{r.name}</option>)}\r\n        </select>\r\n        {roleInvalid && <div className={note}>ต้องเลือก Role</div>}\r\n      </label>\r\n      <label className=\"block\">\r\n        <div className=\"text-xs text-neutral-600 dark:text-neutral-300\">Department (Primary) <span className=\"text-rose-600\">*</span></div>\r\n        <select value={form.departmentId} onChange={(e) => setForm({ ...form, departmentId: e.target.value })} className={cx} required>\r\n          <option value=\"\">- เลือก -</option>\r\n          {departments.map((d) => <option key={d.id} value={String(d.id)}>{d.code} · {d.nameTh || d.nameEn || `Dept#${d.id}`}</option>)}\r\n        </select>\r\n        {deptInvalid && <div className={note}>ต้องเลือก Department</div>}\r\n      </label>\r\n\r\n      {/* actions */}\r\n      <div className=\"sm:col-span-3 flex gap-2\">\r\n        <button\r\n          type=\"submit\"\r\n          disabled={!canSubmit}\r\n          className=\"h-9 px-4 rounded-md bg-black text-white dark:bg-white dark:text-black hover:opacity-90 disabled:opacity-50\"\r\n        >\r\n          {isEditing ? \"บันทึกการแก้ไข\" : \"เพิ่ม\"}\r\n        </button>\r\n        <button type=\"button\" onClick={onCancel} className=\"h-9 px-4 rounded-md border dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800\">\r\n          ล้างฟอร์ม\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1025, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/%28app%29/admin/users/components/UsersTable.jsx"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\n\r\nexport default function UsersTable({\r\n  items = [],\r\n  meta = { page: 1, pages: 1, total: 0 },\r\n  page,\r\n  setPage,\r\n  onEdit,\r\n  onSoftDelete,\r\n  onRestore,\r\n  onHardDelete,\r\n  onResetPassword,\r\n  onManageDepts,\r\n}) {\r\n  const columns = [\"ID\", \"Email\", \"ชื่อ / Role\", \"Organization\", \"Primary / Others\", \"ลบ?\", \"Actions\"];\r\n\r\n  return (\r\n    <section className=\"rounded-xl border dark:border-neutral-700 overflow-hidden\">\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-neutral-100 dark:bg-neutral-800 sticky top-0 z-10\">\r\n            <tr>\r\n              {columns.map((c, i) => (\r\n                <Th key={i} right={c === \"Actions\"}>{c}</Th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n\r\n          <tbody>\r\n            {items.length > 0 ? (\r\n              items.map((u) => {\r\n                const pri = u.primaryUserDept;\r\n                const others = (u.userDepartments || []).filter((d) => d.id !== pri?.id && !d.endedAt);\r\n                const org = u.organization;\r\n\r\n                return (\r\n                  <tr key={u.id} className=\"border-t dark:border-neutral-700 align-top hover:bg-neutral-50/60 dark:hover:bg-neutral-800/50\">\r\n                    <Td>{u.id}</Td>\r\n                    <Td className=\"whitespace-nowrap\">{u.email}</Td>\r\n                    <Td>\r\n                      <div className=\"font-medium\">{u.name || `${u.firstNameTh || \"\"} ${u.lastNameTh || \"\"}`}</div>\r\n                      <div className=\"mt-0.5 text-xs text-neutral-600 dark:text-neutral-300\">{u.role?.name || \"-\"}</div>\r\n                    </Td>\r\n                    <Td className=\"whitespace-nowrap\">\r\n                      {org ? (\r\n                        <>\r\n                          {org.code ? <b>{org.code}</b> : <b>ORG#{org.id}</b>} · {org.nameTh || org.nameEn || \"-\"}\r\n                        </>\r\n                      ) : (\r\n                        <span className=\"text-neutral-500\">-</span>\r\n                      )}\r\n                    </Td>\r\n                    <Td>\r\n                      {pri?.department ? (\r\n                        <div className=\"whitespace-nowrap\">\r\n                          <b>{pri.department.code}</b> · {pri.positionLevel}\r\n                          {pri.positionName ? ` (${pri.positionName})` : \"\"}{\" \"}\r\n                          <span className=\"text-[11px] text-green-700\">Primary</span>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"text-neutral-500\">-</div>\r\n                      )}\r\n                      {others.map((d) => (\r\n                        <div key={d.id} className=\"whitespace-nowrap text-[12px] text-neutral-700 dark:text-neutral-300\">\r\n                          {d.department?.code} · {d.positionLevel}\r\n                          {d.positionName ? ` (${d.positionName})` : \"\"}\r\n                        </div>\r\n                      ))}\r\n                    </Td>\r\n                    <Td>{u.deletedAt ? \"Yes\" : \"-\"}</Td>\r\n                    <Td right>\r\n                      <div className=\"flex flex-wrap gap-1 justify-end\">\r\n                        <GhostButton onClick={() => onEdit(u)}>Edit</GhostButton>\r\n                        <GhostButton onClick={() => onManageDepts(u)}>Manage Depts</GhostButton>\r\n                        {!u.deletedAt ? (\r\n                          <GhostButton className=\"text-amber-700\" onClick={() => onSoftDelete(u)}>Soft Delete</GhostButton>\r\n                        ) : (\r\n                          <>\r\n                            <GhostButton className=\"text-green-700\" onClick={() => onRestore(u)}>Restore</GhostButton>\r\n                            <GhostButton className=\"text-rose-700\" onClick={() => onHardDelete(u)}>Hard Delete</GhostButton>\r\n                          </>\r\n                        )}\r\n                        <GhostButton className=\"text-purple-700\" onClick={() => onResetPassword(u)}>Reset Password</GhostButton>\r\n                      </div>\r\n                    </Td>\r\n                  </tr>\r\n                );\r\n              })\r\n            ) : (\r\n              <tr>\r\n                <Td colSpan={7} className=\"px-3 py-6 text-center text-neutral-500\">ไม่พบข้อมูล</Td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <div className=\"flex items-center justify-between p-3\">\r\n        <div className=\"text-xs text-neutral-500\">ทั้งหมด {meta.total} รายการ</div>\r\n        <div className=\"flex gap-2\">\r\n          <GhostButton disabled={page <= 1} onClick={() => setPage((p) => p - 1)}>Prev</GhostButton>\r\n          <div className=\"text-sm\">Page {meta.page} / {meta.pages || 1}</div>\r\n          <GhostButton disabled={page >= (meta.pages || 1)} onClick={() => setPage((p) => p + 1)}>Next</GhostButton>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction GhostButton({ children, className = \"\", ...rest }) {\r\n  return (\r\n    <button\r\n      className={`px-2 py-1 rounded-md border dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800 disabled:opacity-50 ${className}`}\r\n      {...rest}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n}\r\n\r\nfunction Th({ children, right }) {\r\n  return (\r\n    <th className={`px-3 py-2 ${right ? \"text-right\" : \"text-left\"} text-neutral-700 dark:text-neutral-200`}>{children}</th>\r\n  );\r\n}\r\nfunction Td({ children, right, className = \"\", ...rest }) {\r\n  return (\r\n    <td className={`px-3 py-2 ${right ? \"text-right\" : \"\"} ${className}`} {...rest}>{children}</td>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1455, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/%28app%29/admin/users/ManageUserDepartmentsDialog.jsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { apiFetch } from \"@/lib/api\";\r\n\r\nexport const PositionLevels = [\"STAF\", \"SVR\", \"ASST\", \"MANAGER\", \"MD\"];\r\nconst idx = (lv) => PositionLevels.indexOf(lv);\r\n\r\nexport default function ManageUserDepartmentsDialog({\r\n  open,\r\n  onClose,\r\n  user,\r\n  departments = [],\r\n  onChanged,\r\n}) {\r\n  const [items, setItems] = useState([]);\r\n  const [busy, setBusy] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const userId = user?.id;\r\n  const boxRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const onKey = (e) => e.key === \"Escape\" && onClose?.();\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open, onClose]);\r\n\r\n  async function load() {\r\n    if (!userId) return;\r\n    try {\r\n      const r = await apiFetch(`/api/users/${userId}/departments`);\r\n      setItems(r?.data || []);\r\n      setError(\"\");\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"โหลดข้อมูลสังกัดไม่สำเร็จ\");\r\n    }\r\n  }\r\n  useEffect(() => { if (open) load(); /* eslint-disable-line */ }, [open, userId]);\r\n\r\n  async function addAssignment(e) {\r\n    e.preventDefault();\r\n    const fd = new FormData(e.currentTarget);\r\n    const departmentId = Number(fd.get(\"departmentId\"));\r\n    const positionLevel = fd.get(\"positionLevel\");\r\n    const positionName = fd.get(\"positionName\") || undefined;\r\n    const setPrimary = fd.get(\"setPrimary\") === \"on\";\r\n    if (!departmentId || !positionLevel) return;\r\n\r\n    setBusy(true);\r\n    try {\r\n      await apiFetch(`/api/users/${userId}/departments`, {\r\n        method: \"POST\",\r\n        body: { departmentId, positionLevel, positionName, setPrimary },\r\n      });\r\n      e.currentTarget.reset?.();\r\n      await load();\r\n      onChanged?.();\r\n    } catch (err) {\r\n      setError(err?.data?.error || err?.message || \"เพิ่มสังกัดไม่สำเร็จ\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function setPrimary(udId) {\r\n    setBusy(true);\r\n    try {\r\n      await apiFetch(`/api/users/${userId}/primary/${udId}`, { method: \"POST\" });\r\n      await load();\r\n      onChanged?.();\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"ตั้ง primary ไม่สำเร็จ\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function endAssignment(udId) {\r\n    if (!confirm(\"ปิดสังกัดนี้ (endedAt = ตอนนี้)?\")) return;\r\n    setBusy(true);\r\n    try {\r\n      await apiFetch(`/api/users/${userId}/departments/${udId}`, {\r\n        method: \"PATCH\",\r\n        body: { endedAt: new Date().toISOString() },\r\n      });\r\n      await load();\r\n      onChanged?.();\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"ปิดสังกัดไม่สำเร็จ\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function applyLevel(ud, toLevel, positionName) {\r\n    const fromLevel = ud.positionLevel;\r\n    if (!toLevel || toLevel === fromLevel) return savePosition(ud.id, fromLevel, positionName);\r\n    setBusy(true);\r\n    try {\r\n      if (idx(toLevel) > idx(fromLevel)) {\r\n        await apiFetch(`/api/users/${userId}/departments/${ud.id}/promote`, { method: \"POST\", body: { toLevel, positionName: positionName || undefined } });\r\n      } else {\r\n        await apiFetch(`/api/users/${userId}/departments/${ud.id}/demote`, { method: \"POST\", body: { toLevel, positionName: positionName || undefined } });\r\n      }\r\n      await load();\r\n      onChanged?.();\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"อัปเดตระดับไม่สำเร็จ\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function savePosition(udId, positionLevel, positionName) {\r\n    setBusy(true);\r\n    try {\r\n      await apiFetch(`/api/users/${userId}/departments/${udId}`, { method: \"PATCH\", body: { positionLevel, positionName } });\r\n      await load();\r\n      onChanged?.();\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"อัปเดตตำแหน่งไม่สำเร็จ\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  if (!open) return null;\r\n\r\n  const active = items.filter((x) => !x.endedAt);\r\n  const ended = items.filter((x) => !!x.endedAt);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4\" onClick={() => onClose?.()}>\r\n      <div\r\n        ref={boxRef}\r\n        className=\"w-full max-w-4xl rounded-xl bg-white dark:bg-neutral-900 dark:border-neutral-700 border shadow-xl p-4\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h3 className=\"text-lg font-semibold text-neutral-800 dark:text-neutral-100\">Manage Departments</h3>\r\n            <div className=\"text-sm text-neutral-600 dark:text-neutral-300\">{user?.email}</div>\r\n          </div>\r\n          <button className=\"px-3 py-1.5 rounded-md border dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800\" onClick={() => onClose?.()}>\r\n            Close\r\n          </button>\r\n        </div>\r\n\r\n        {/* Add assignment */}\r\n        <section className=\"rounded-lg border dark:border-neutral-700 p-3 mb-4\">\r\n          <h4 className=\"font-medium mb-2\">เพิ่มสังกัด</h4>\r\n          <form className=\"grid gap-3 sm:grid-cols-4\" onSubmit={addAssignment}>\r\n            <label className=\"block\">\r\n              <div className=\"text-xs\">Department</div>\r\n              <select name=\"departmentId\" className=\"mt-1 w-full rounded-md border px-3 py-2 text-sm dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-100\" required>\r\n                <option value=\"\">- เลือก -</option>\r\n                {departments.map((d) => (\r\n                  <option key={d.id} value={d.id}>{d.code} · {d.nameTh || d.nameEn || `Dept#${d.id}`}</option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"block\">\r\n              <div className=\"text-xs\">Position Level</div>\r\n              <select name=\"positionLevel\" className=\"mt-1 w-full rounded-md border px-3 py-2 text-sm dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-100\" required>\r\n                <option value=\"\">- เลือก -</option>\r\n                {PositionLevels.map((lv) => (<option key={lv} value={lv}>{lv}</option>))}\r\n              </select>\r\n            </label>\r\n            <label className=\"block\">\r\n              <div className=\"text-xs\">Position Name (optional)</div>\r\n              <input name=\"positionName\" className=\"mt-1 w-full rounded-md border px-3 py-2 text-sm dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-100\" placeholder=\"เช่น QMR\" />\r\n            </label>\r\n            <label className=\"block flex items-end gap-2\">\r\n              <input type=\"checkbox\" name=\"setPrimary\" className=\"scale-110\" />\r\n              <span className=\"text-sm\">ตั้งเป็น Primary</span>\r\n            </label>\r\n            <div className=\"sm:col-span-4\">\r\n              <button disabled={busy} className=\"h-9 px-4 rounded-md border dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800\">\r\n                {busy ? \"Saving...\" : \"Add assignment\"}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </section>\r\n\r\n        <Section title={`กำลังใช้งาน (${active.length})`}>\r\n          {active.map((x) => (\r\n            <Row key={x.id} x={x} ended={false} onApply={applyLevel} onSetPrimary={setPrimary} onEnd={endAssignment} />\r\n          ))}\r\n          {!active.length && <EmptyRow text=\"ยังไม่มีสังกัดที่ใช้งาน\" />}\r\n        </Section>\r\n\r\n        <Section title={`สิ้นสุดแล้ว (${ended.length})`} muted>\r\n          {ended.map((x) => (<Row key={x.id} x={x} ended onApply={applyLevel} />))}\r\n          {!ended.length && <EmptyRow text=\"ไม่มีประวัติที่สิ้นสุด\" />}\r\n        </Section>\r\n\r\n        {!!error && <div className=\"mt-3 text-red-600 text-sm\">{error}</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Section({ title, muted = false, children }) {\r\n  return (\r\n    <section className=\"rounded-lg border dark:border-neutral-700 overflow-hidden mb-4\">\r\n      <div className={`${muted ? \"bg-neutral-100 dark:bg-neutral-800\" : \"bg-sky-50 dark:bg-sky-900/20\"} px-3 py-2 text-sm font-medium`}>{title}</div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-neutral-50 dark:bg-neutral-900\">\r\n            <tr>\r\n              <Th>Dept</Th>\r\n              <Th>Level / Name</Th>\r\n              <Th>Started</Th>\r\n              <Th>Ended</Th>\r\n              <Th right>Actions</Th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>{children}</tbody>\r\n        </table>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction Row({ x, ended, onApply, onSetPrimary, onEnd }) {\r\n  const [toLevel, setToLevel] = useState(x.positionLevel);\r\n  const [pname, setPname] = useState(x.positionName || \"\");\r\n\r\n  useEffect(() => { setToLevel(x.positionLevel); setPname(x.positionName || \"\"); }, [x.positionLevel, x.positionName]);\r\n\r\n  const dept = x.department;\r\n  const changed = toLevel !== x.positionLevel || (pname || \"\") !== (x.positionName || \"\");\r\n\r\n  return (\r\n    <tr className=\"border-t dark:border-neutral-700 align-top\">\r\n      <Td className=\"whitespace-nowrap\">\r\n        <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-sky-100 dark:bg-sky-900/30 text-sky-700 dark:text-sky-300\">\r\n          {dept?.code}\r\n        </span>{\" \"}\r\n        <span className=\"text-neutral-700 dark:text-neutral-200\">{dept?.nameTh || dept?.nameEn}</span>\r\n      </Td>\r\n\r\n      <Td>\r\n        <div className=\"flex flex-wrap items-center gap-2\">\r\n          <select className=\"border dark:border-neutral-700 rounded-md px-2 py-1 text-sm dark:bg-neutral-800 dark:text-neutral-100\" value={toLevel} onChange={(e) => setToLevel(e.target.value)} disabled={ended} title=\"เปลี่ยนระดับตำแหน่ง\">\r\n            {PositionLevels.map((lv) => (<option key={lv} value={lv}>{lv}</option>))}\r\n          </select>\r\n          <input className=\"border dark:border-neutral-700 rounded-md px-2 py-1 text-sm dark:bg-neutral-800 dark:text-neutral-100\" placeholder=\"ตำแหน่ง (เช่น QMR)\" value={pname} onChange={(e) => setPname(e.target.value)} disabled={ended} />\r\n          {!ended && (\r\n            <button disabled={!changed} onClick={() => onApply(x, toLevel, pname)} className=\"px-2 py-1 rounded-md border dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800 disabled:opacity-50\">\r\n              Apply\r\n            </button>\r\n          )}\r\n        </div>\r\n      </Td>\r\n\r\n      <Td className=\"whitespace-nowrap\">{x.startedAt ? new Date(x.startedAt).toLocaleString() : \"-\"}</Td>\r\n      <Td className=\"whitespace-nowrap\">{x.endedAt ? new Date(x.endedAt).toLocaleString() : \"-\"}</Td>\r\n\r\n      <Td right>\r\n        <div className=\"flex flex-wrap gap-1 justify-end\">\r\n          {!ended && (\r\n            <>\r\n              {!x.isPrimary && (\r\n                <button onClick={() => onSetPrimary(x.id)} className=\"px-2 py-1 rounded-md border dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800\">\r\n                  Set Primary\r\n                </button>\r\n              )}\r\n              <button onClick={() => onEnd(x.id)} className=\"px-2 py-1 rounded-md border text-amber-700 hover:bg-amber-50 dark:hover:bg-amber-900/30\">\r\n                End\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>\r\n      </Td>\r\n    </tr>\r\n  );\r\n}\r\n\r\nfunction Th({ children, right }) {\r\n  return <th className={`px-3 py-2 ${right ? \"text-right\" : \"text-left\"} text-neutral-700 dark:text-neutral-200`}>{children}</th>;\r\n}\r\nfunction Td({ children, right, className = \"\" }) {\r\n  return <td className={`px-3 py-2 ${right ? \"text-right\" : \"\"} ${className}`}>{children}</td>;\r\n}\r\nfunction EmptyRow({ text }) {\r\n  return (\r\n    <tr>\r\n      <td colSpan={5} className=\"px-3 py-6 text-center text-neutral-500\">{text}</td>\r\n    </tr>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2261, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/%28app%29/admin/users/page.jsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { apiFetch } from \"@/lib/api\";\r\nimport { useAuth, hasRole } from \"@/components/local-auth\";\r\n\r\nimport FiltersBar from \"./components/FiltersBar\";\r\nimport UserForm from \"./components/UserForm\";\r\nimport UsersTable from \"./components/UsersTable\";\r\nimport ManageUserDepartmentsDialog from \"./ManageUserDepartmentsDialog\";\r\n\r\nconst PAGE_SIZE = 20;\r\n\r\nasync function fetchUserDetail(id) {\r\n  return apiFetch(`/api/users/${id}`);\r\n}\r\n\r\n// helper: ตัดค่าว่างออกจาก payload\r\nfunction n(v) {\r\n  if (v === undefined || v === null) return undefined;\r\n  if (typeof v === \"string\" && v.trim() === \"\") return undefined;\r\n  return v;\r\n}\r\n\r\nexport default function AdminUsersPage() {\r\n  const { user, loading } = useAuth();\r\n  const isAdmin = hasRole(user, \"admin\");\r\n\r\n  const [roles, setRoles] = useState([]);\r\n  const [departments, setDepartments] = useState([]);\r\n  const [organizations, setOrganizations] = useState([]);\r\n\r\n  const [q, setQ] = useState(\"\");\r\n  const [roleId, setRoleId] = useState(\"\");\r\n  const [departmentId, setDepartmentId] = useState(\"\");\r\n  const [includeDeleted, setIncludeDeleted] = useState(false);\r\n\r\n  const [page, setPage] = useState(1);\r\n  const [items, setItems] = useState([]);\r\n  const [meta, setMeta] = useState({ page: 1, pages: 1, total: 0 });\r\n  const [busy, setBusy] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const [deptOpen, setDeptOpen] = useState(false);\r\n  const [deptUser, setDeptUser] = useState(null);\r\n\r\n  const [form, setForm] = useState({\r\n    id: null,\r\n    email: \"\",\r\n    name: \"\",\r\n    firstNameTh: \"\",\r\n    lastNameTh: \"\",\r\n    firstNameEn: \"\",\r\n    lastNameEn: \"\",\r\n    roleId: \"\",\r\n    departmentId: \"\",\r\n    password: \"\",\r\n    orgId: \"\",\r\n    orgLabel: \"\",\r\n    employeeCode: \"\",\r\n    employeeType: \"\",\r\n    contractType: \"\",\r\n    gender: \"\",\r\n    birthDate: \"\",\r\n    startDate: \"\",\r\n    probationEndDate: \"\",\r\n    resignedAt: \"\",\r\n  });\r\n  const isEditing = useMemo(() => form.id !== null, [form.id]);\r\n\r\n  useEffect(() => {\r\n    if (!loading && !isAdmin) {\r\n      // TODO: redirect/guard ถ้าจำเป็น\r\n    }\r\n  }, [loading, isAdmin]);\r\n\r\n  async function loadRef() {\r\n    try {\r\n      const [r1, r2] = await Promise.all([\r\n        apiFetch(`/api/roles?page=1&limit=999`),\r\n        apiFetch(`/api/departments?page=1&limit=999`),\r\n      ]);\r\n      setRoles(r1?.data || []);\r\n      setDepartments(r2?.data || []);\r\n    } catch {}\r\n    try {\r\n      const r3 = await apiFetch(`/api/organizations?page=1&limit=999`);\r\n      setOrganizations(r3?.data || []);\r\n    } catch {\r\n      setOrganizations([]);\r\n    }\r\n  }\r\n\r\n  async function load() {\r\n    setBusy(true);\r\n    try {\r\n      const params = new URLSearchParams({\r\n        page: String(page),\r\n        limit: String(PAGE_SIZE),\r\n        sortBy: \"id\",\r\n        sort: \"asc\",\r\n      });\r\n      if (q) params.set(\"q\", q);\r\n      if (roleId) params.set(\"roleId\", roleId);\r\n      if (departmentId) params.set(\"departmentId\", departmentId);\r\n      if (includeDeleted) params.set(\"includeDeleted\", \"1\");\r\n\r\n      const res = await apiFetch(`/api/users?${params.toString()}`);\r\n      setItems(res?.data || []);\r\n      setMeta(res?.meta || { page: 1, pages: 1, total: 0 });\r\n      setError(\"\");\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"โหลดข้อมูลไม่สำเร็จ\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => { loadRef(); }, []);\r\n  useEffect(() => { load(); /* eslint-disable-next-line */ }, [q, roleId, departmentId, includeDeleted, page]);\r\n\r\n  function resetForm() {\r\n    setForm((s) => ({\r\n      ...s,\r\n      id: null,\r\n      email: \"\",\r\n      name: \"\",\r\n      firstNameTh: \"\",\r\n      lastNameTh: \"\",\r\n      firstNameEn: \"\",\r\n      lastNameEn: \"\",\r\n      roleId: roles.find(r => r.name?.toLowerCase() === \"user\")?.id || \"\",\r\n      departmentId: \"\",\r\n      password: \"\",\r\n      orgId: \"\",\r\n      orgLabel: \"\",\r\n      employeeCode: \"\",\r\n      employeeType: \"\",\r\n      contractType: \"\",\r\n      gender: \"\",\r\n      birthDate: \"\",\r\n      startDate: \"\",\r\n      probationEndDate: \"\",\r\n      resignedAt: \"\",\r\n    }));\r\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n  }\r\n\r\n  // ✅ validate ขั้นต่ำ + sanitize payload\r\n  function buildPayload() {\r\n    const requiredMsg = [];\r\n    if (!form.email) requiredMsg.push(\"อีเมล\");\r\n    if (!isEditing && (!form.password || form.password.length < 8)) requiredMsg.push(\"รหัสผ่าน (อย่างน้อย 8 ตัว)\");\r\n    if (!form.roleId) requiredMsg.push(\"Role\");\r\n    if (!form.departmentId) requiredMsg.push(\"Department\");\r\n\r\n    if (requiredMsg.length) {\r\n      throw new Error(`กรุณากรอก: ${requiredMsg.join(\", \")}`);\r\n    }\r\n\r\n    const payload = {\r\n      email: form.email,\r\n      name: n(form.name),\r\n      firstNameTh: n(form.firstNameTh),\r\n      lastNameTh: n(form.lastNameTh),\r\n      firstNameEn: n(form.firstNameEn),\r\n      lastNameEn: n(form.lastNameEn),\r\n      roleId: Number(form.roleId),\r\n      departmentId: Number(form.departmentId),\r\n      orgId: n(form.orgId) ? Number(form.orgId) : undefined,\r\n      employeeCode: n(form.employeeCode) ?? null,\r\n      employeeType: n(form.employeeType) ?? null,\r\n      contractType: n(form.contractType) ?? null,\r\n      gender: n(form.gender) ?? null,\r\n      birthDate: n(form.birthDate) ?? null,\r\n      startDate: n(form.startDate) ?? null,\r\n      probationEndDate: n(form.probationEndDate) ?? null,\r\n      resignedAt: n(form.resignedAt) ?? null,\r\n    };\r\n\r\n    if (!isEditing) {\r\n      payload.password = form.password; // สร้างใหม่ต้องส่ง\r\n    }\r\n\r\n    return payload;\r\n  }\r\n\r\n  async function handleSubmit(e) {\r\n    e.preventDefault(); setBusy(true);\r\n    try {\r\n      const payload = buildPayload();\r\n      if (isEditing) {\r\n        await apiFetch(`/api/users/${form.id}`, { method: \"PATCH\", body: payload });\r\n      } else {\r\n        await apiFetch(`/api/users`, { method: \"POST\", body: payload });\r\n      }\r\n      resetForm(); load();\r\n    } catch (e2) {\r\n      setError(e2?.data?.error || e2?.message || \"บันทึกไม่สำเร็จ\");\r\n    } finally { setBusy(false); }\r\n  }\r\n\r\n  async function handleEdit(u) {\r\n    try {\r\n      const detail = await fetchUserDetail(u.id);\r\n      const d = detail?.data || u;\r\n      const orgIdStr = d.organization?.id ? String(d.organization.id) : \"\";\r\n      const orgLabel =\r\n        d.organization\r\n          ? `${d.organization.code ? d.organization.code + \" · \" : \"\"}${\r\n              d.organization.nameTh || d.organization.nameEn || `Org#${d.organization.id}`\r\n            }`\r\n          : \"\";\r\n\r\n      setForm({\r\n        id: d.id,\r\n        email: d.email || \"\",\r\n        name: d.name || \"\",\r\n        firstNameTh: d.firstNameTh || \"\",\r\n        lastNameTh: d.lastNameTh || \"\",\r\n        firstNameEn: d.firstNameEn || \"\",\r\n        lastNameEn: d.lastNameEn || \"\",\r\n        roleId: d.role?.id || \"\",\r\n        departmentId: d.primaryUserDept?.department?.id || \"\",\r\n        password: \"\",\r\n        orgId: orgIdStr,\r\n        orgLabel,\r\n        employeeCode: d.employeeCode || \"\",\r\n        employeeType: d.employeeType || \"\",\r\n        contractType: d.contractType || \"\",\r\n        gender: d.gender || \"\",\r\n        birthDate: d.birthDate ? d.birthDate.substring(0, 10) : \"\",\r\n        startDate: d.startDate ? d.startDate.substring(0, 10) : \"\",\r\n        probationEndDate: d.probationEndDate ? d.probationEndDate.substring(0, 10) : \"\",\r\n        resignedAt: d.resignedAt ? d.resignedAt.substring(0, 10) : \"\",\r\n      });\r\n      window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"โหลดรายละเอียดผู้ใช้ไม่สำเร็จ\");\r\n    }\r\n  }\r\n\r\n  async function handleToggleDelete(u, hard = false) {\r\n    if (hard ? !confirm(`ลบถาวรผู้ใช้ ${u.email}?`) : (!u.deletedAt && !confirm(`ลบผู้ใช้ ${u.email}? (soft delete)`))) return;\r\n    setBusy(true);\r\n    try {\r\n      await apiFetch(`/api/users/${u.id}${hard ? \"?hard=1\" : \"\"}`, { method: \"DELETE\" });\r\n      load();\r\n    } catch (e) {\r\n      setError(e?.data?.error || e?.message || \"ทำรายการไม่สำเร็จ\");\r\n    } finally { setBusy(false); }\r\n  }\r\n\r\n  async function handleRestore(u) {\r\n    setBusy(true);\r\n    try { await apiFetch(`/api/users/${u.id}/restore`, { method: \"POST\" }); load(); }\r\n    catch (e) { setError(e?.data?.error || e?.message || \"กู้คืนไม่สำเร็จ\"); }\r\n    finally { setBusy(false); }\r\n  }\r\n\r\n  async function handleResetPassword(u) {\r\n    const newPassword = prompt(\"ตั้งรหัสผ่านใหม่ (อย่างน้อย 8 ตัว)\"); if (!newPassword) return;\r\n    setBusy(true);\r\n    try { await apiFetch(`/api/users/${u.id}/reset-password`, { method: \"POST\", body: { newPassword } }); alert(\"รีเซ็ตรหัสผ่านแล้ว\"); }\r\n    catch (e) { setError(e?.data?.error || e?.message || \"รีเซ็ตรหัสผ่านไม่สำเร็จ\"); }\r\n    finally { setBusy(false); }\r\n  }\r\n\r\n  function openManageDepts(u) { setDeptUser(u); setDeptOpen(true); }\r\n\r\n  const filters = {\r\n    q, setQ, roleId, setRoleId, departmentId, setDepartmentId,\r\n    includeDeleted, setIncludeDeleted,\r\n    onClear: () => { setQ(\"\"); setRoleId(\"\"); setDepartmentId(\"\"); setIncludeDeleted(false); setPage(1); },\r\n  };\r\n\r\n  // ✅ canSubmit สำหรับส่งให้ปุ่มในฟอร์ม\r\n  const canSubmit = Boolean(\r\n    form.email &&\r\n    (isEditing || (form.password && form.password.length >= 8)) &&\r\n    form.roleId &&\r\n    form.departmentId\r\n  );\r\n\r\n  return (\r\n    <main className=\"pt-20 px-4 sm:px-6 lg:px-8 max-w-screen-xl mx-auto space-y-4\">\r\n      <header className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <h1 className=\"text-xl sm:text-2xl font-semibold text-neutral-800 dark:text-neutral-100\">Users</h1>\r\n      </header>\r\n\r\n      <FiltersBar roles={roles} departments={departments} filters={filters} />\r\n\r\n      <section className=\"rounded-xl border dark:border-neutral-700 bg-white dark:bg-neutral-900 p-4\">\r\n        <h2 className=\"font-medium mb-3 text-neutral-800 dark:text-neutral-100\">{isEditing ? \"แก้ไขผู้ใช้\" : \"เพิ่มผู้ใช้ใหม่\"}</h2>\r\n        <UserForm\r\n          roles={roles}\r\n          departments={departments}\r\n          organizations={organizations}\r\n          form={form}\r\n          setForm={setForm}\r\n          isEditing={isEditing}\r\n          onSubmit={handleSubmit}\r\n          onCancel={resetForm}\r\n          canSubmit={canSubmit}\r\n        />\r\n      </section>\r\n\r\n      <UsersTable\r\n        items={items}\r\n        meta={meta}\r\n        page={page}\r\n        setPage={setPage}\r\n        onEdit={handleEdit}\r\n        onSoftDelete={(u) => handleToggleDelete(u, false)}\r\n        onRestore={handleRestore}\r\n        onHardDelete={(u) => handleToggleDelete(u, true)}\r\n        onResetPassword={handleResetPassword}\r\n        onManageDepts={openManageDepts}\r\n      />\r\n\r\n      <ManageUserDepartmentsDialog\r\n        open={deptOpen}\r\n        onClose={() => setDeptOpen(false)}\r\n        user={deptUser}\r\n        departments={departments}\r\n        onChanged={() => load()}\r\n      />\r\n\r\n      {!!error && (\r\n        <div className=\"rounded-md border border-rose-300 bg-rose-50 dark:bg-rose-900/20 dark:border-rose-800 p-3 text-sm text-rose-700 dark:text-rose-300\">\r\n          {error}\r\n        </div>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}