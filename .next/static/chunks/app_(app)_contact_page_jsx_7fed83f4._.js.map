{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Workspace/emperorhouse-frontend/app/%28app%29/contact/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { apiFetch } from \"@/lib/api\"; // ← ใช้ lib/api แทนอ่าน env เอง\r\n\r\n// กันสแปมแบบเบา ๆ\r\nconst MIN_FILL_SECONDS = 5;\r\nconst COOLDOWN_SECONDS = 10;\r\n\r\nconst initialForm = {\r\n  name: \"\",\r\n  email: \"\",\r\n  phone: \"\",\r\n  subject: \"\",\r\n  message: \"\",\r\n  website: \"\", // honeypot\r\n};\r\n\r\nexport default function ContactPage() {\r\n  const [form, setForm] = useState(initialForm);\r\n  const [status, setStatus] = useState(null); // { ok:boolean, msg:string }\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [cooldownLeft, setCooldownLeft] = useState(0);\r\n\r\n  // เวลาเริ่มกรอก (ใช้เช็ค min fill time)\r\n  const startedAtRef = useRef(Date.now());\r\n\r\n  useEffect(() => {\r\n    if (!cooldownLeft) return;\r\n    const t = setInterval(\r\n      () => setCooldownLeft((s) => Math.max(0, s - 1)),\r\n      1000\r\n    );\r\n    return () => clearInterval(t);\r\n  }, [cooldownLeft]);\r\n\r\n  const onChange = (e) =>\r\n    setForm((f) => ({ ...f, [e.target.name]: e.target.value }));\r\n\r\n  // เผื่อ backend อยากใช้ตรวจเพิ่มเติม\r\n  const clientNonce = useMemo(() => Math.random().toString(36).slice(2), []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (submitting || cooldownLeft > 0) return;\r\n\r\n    setSubmitting(true);\r\n    setStatus(null);\r\n\r\n    try {\r\n      if (!form.name || !form.email || !form.subject || !form.message) {\r\n        throw new Error(\"กรอกข้อมูลให้ครบที่จำเป็น\");\r\n      }\r\n      if ((form.website || \"\").trim() !== \"\") {\r\n        throw new Error(\"Bot detected\");\r\n      }\r\n      const elapsed = (Date.now() - startedAtRef.current) / 1000;\r\n      if (elapsed < MIN_FILL_SECONDS) {\r\n        throw new Error(\"กรุณาตรวจสอบข้อมูลแล้วส่งอีกครั้ง\");\r\n      }\r\n\r\n      // ถ้า backend ของคุณ mount ไว้ใต้ /api ให้เปลี่ยน path เป็น \"/api/contact\"\r\n      const resp = await apiFetch(\"/api/contacts\", {\r\n        method: \"POST\",\r\n        headers: { \"X-Client-Nonce\": clientNonce },\r\n        body: {\r\n          ...form,\r\n          startedAtMs: startedAtRef.current,\r\n        },\r\n      });\r\n\r\n      if (!resp?.ok) {\r\n        throw new Error(resp?.error || \"Submit failed\");\r\n      }\r\n\r\n      setStatus({ ok: true, msg: \"ส่งข้อความเรียบร้อย ขอบคุณครับ/ค่ะ\" });\r\n      setForm(initialForm);\r\n      setCooldownLeft(COOLDOWN_SECONDS);\r\n      startedAtRef.current = Date.now();\r\n    } catch (err) {\r\n      const msg = err?.message || \"เกิดข้อผิดพลาด\";\r\n      setStatus({ ok: false, msg });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const disabled = submitting || cooldownLeft > 0;\r\n\r\n  return (\r\n    <main className=\"mx-auto max-w-5xl p-6 py-30 space-y-8\">\r\n      <h1 className=\"text-3xl font-semibold mb-6\">Contact Us</h1>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n        <div className=\"grid grid-cols-1 gap-4\">\r\n          <label className=\"block\">\r\n            <span className=\"text-sm\">ชื่อ</span>\r\n            <input\r\n              name=\"name\"\r\n              value={form.name}\r\n              onChange={onChange}\r\n              className=\"mt-1 w-full rounded-xl border px-3 py-2\"\r\n              placeholder=\"Your name\"\r\n              required\r\n              maxLength={120}\r\n            />\r\n          </label>\r\n\r\n          <label className=\"block\">\r\n            <span className=\"text-sm\">อีเมล</span>\r\n            <input\r\n              type=\"email\"\r\n              name=\"email\"\r\n              value={form.email}\r\n              onChange={onChange}\r\n              className=\"mt-1 w-full rounded-xl border px-3 py-2\"\r\n              placeholder=\"you@example.com\"\r\n              required\r\n              maxLength={160}\r\n            />\r\n          </label>\r\n\r\n          <label className=\"block\">\r\n            <span className=\"text-sm\">โทรศัพท์ (ถ้ามี)</span>\r\n            <input\r\n              name=\"phone\"\r\n              value={form.phone}\r\n              onChange={onChange}\r\n              className=\"mt-1 w-full rounded-xl border px-3 py-2\"\r\n              placeholder=\"Optional\"\r\n              maxLength={32}\r\n            />\r\n          </label>\r\n\r\n          <label className=\"block\">\r\n            <span className=\"text-sm\">หัวข้อ</span>\r\n            <input\r\n              name=\"subject\"\r\n              value={form.subject}\r\n              onChange={onChange}\r\n              className=\"mt-1 w-full rounded-xl border px-3 py-2\"\r\n              placeholder=\"Subject\"\r\n              required\r\n              maxLength={160}\r\n            />\r\n          </label>\r\n\r\n          <label className=\"block\">\r\n            <span className=\"text-sm\">ข้อความ</span>\r\n            <textarea\r\n              name=\"message\"\r\n              value={form.message}\r\n              onChange={onChange}\r\n              className=\"mt-1 w-full rounded-xl border px-3 py-2 h-40\"\r\n              placeholder=\"Write your message...\"\r\n              required\r\n              maxLength={5000}\r\n            />\r\n          </label>\r\n\r\n          {/* honeypot: ซ่อนไว้สำหรับบอท */}\r\n          <label className=\"block sr-only\" aria-hidden=\"true\">\r\n            <span>Website</span>\r\n            <input\r\n              name=\"website\"\r\n              value={form.website}\r\n              onChange={onChange}\r\n              autoComplete=\"off\"\r\n              tabIndex={-1}\r\n            />\r\n          </label>\r\n        </div>\r\n\r\n        {status && (\r\n          <p\r\n            className={`text-sm ${\r\n              status.ok ? \"text-green-600\" : \"text-red-600\"\r\n            }`}\r\n          >\r\n            {status.msg}\r\n          </p>\r\n        )}\r\n\r\n        <button\r\n          type=\"submit\"\r\n          disabled={disabled}\r\n          className=\"rounded-xl border px-4 py-2 disabled:opacity-50\"\r\n        >\r\n          {submitting\r\n            ? \"กำลังส่ง...\"\r\n            : cooldownLeft > 0\r\n            ? `โปรดรอ ${cooldownLeft}s`\r\n            : \"ส่งข้อความ\"}\r\n        </button>\r\n\r\n        <p className=\"text-xs text-neutral-500 mt-3\">\r\n          * มีระบบกันสแปมขั้นพื้นฐาน (honeypot, min fill time, cooldown)\r\n        </p>\r\n      </form>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}